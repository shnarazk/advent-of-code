Solve â‡ {envâ€¿part ğ•Š data :
  utilâ€¿geometry â† â€¢ImportÂ¨"/util.bqn"â€¿"/geometry.bqn"âˆ¾ËœÂ¨<"." env.VarâŒ¾â‹ˆ "BQN_LIB"
  data â†© 'L'=>data
  # floorâ€¿emptyâ€¿occupied â† â†•3
  Flip â† {1 ğ•Š 0 : 2 ; 2 ğ•Š m : 5â‰¤m ? 1 ; w ğ•Š m : w}Â¨
  {
    1=part ? +Â´â¥Š2=âŠ‘{âŸ¨FlipâŸœ((+Â´2âŠ¸=)Â¨geometry.Neighbor9)âŠ‘ğ•©,âŠ‘ğ•©âŸ©}â€¢_while_(â‰¢Â´)â‹ˆâŸœ(0Â¨)data ;
    grid â† â†•â‹ˆËœâŒˆÂ´ hâ€¿w â† â‰¢data
    tran â† âˆ¾âŒœ{Ã—âˆ˜â‰ â—¶âŸ¨âŸ¨âŸ©,1âŠ¸â†‘âŸ©(1=âŠ‘âŸœdata)Â¨âŠ¸/ğ•©}Â¨âŒœ{yâ€¿x :
      âŸ¨
        âŒ½(    0â€¿0âŠ¸â‰¤âˆ§â—‹(âˆ§Â´)yâ€¿wâŠ¸>)Â¨âŠ¸/xâŠâ‰1 grid
         ((y+1)â€¿0âŠ¸â‰¤âˆ§â—‹(âˆ§Â´)hâ€¿wâŠ¸>)Â¨âŠ¸/xâŠâ‰1 grid
        âŒ½(    0â€¿0âŠ¸â‰¤âˆ§â—‹(âˆ§Â´)hâ€¿xâŠ¸>)Â¨âŠ¸/yâŠâ‰2 grid
         (0â€¿(x+1)âŠ¸â‰¤âˆ§â—‹(âˆ§Â´)hâ€¿wâŠ¸>)Â¨âŠ¸/yâŠâ‰2 grid
        âŒ½(    0â€¿0âŠ¸â‰¤âˆ§â—‹(âˆ§Â´)yâ€¿xâŠ¸>)Â¨âŠ¸/âŸ¨0,x-yâŸ©<âŠ¸+0â€¿0â‰grid
         (    yâ€¿xâŠ¸<âˆ§â—‹(âˆ§Â´)hâ€¿wâŠ¸>)Â¨âŠ¸/âŸ¨0,x-yâŸ©<âŠ¸+0â€¿0â‰grid
        âŒ½((y+1)â€¿0âŠ¸â‰¤âˆ§â—‹(âˆ§Â´)hâ€¿xâŠ¸>)Â¨âŠ¸/âŸ¨0,(x+y)-(w-1)âŸ©<âŠ¸+0â€¿0â‰âŒ½grid
         (    0â€¿xâŠ¸â‰¤âˆ§â—‹(âˆ§Â´)yâ€¿wâŠ¸>)Â¨âŠ¸/âŸ¨0,(x+y)-(w-1)âŸ©<âŠ¸+0â€¿0â‰âŒ½grid
      âŸ©
    }Â¨â†•hâ€¿w
    +Â´â¥Š2=âŠ‘{âŸ¨FlipâŸœ((+Â´2=âŠ‘âŸœ(âŠ‘ğ•©))Â¨tran)âŠ‘ğ•©,âŠ‘ğ•©âŸ©}â€¢_while_(â‰¢Â´)â‹ˆâŸœ(0Â¨)data
  }
}
