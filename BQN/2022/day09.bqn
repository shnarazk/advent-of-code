DirVec â† {
  FâŸ¨"U",râŸ© : âŸ¨ 0,-1âŸ© ;
  FâŸ¨"D",râŸ© : âŸ¨ 0, 1âŸ© ;
  FâŸ¨"L",râŸ© : âŸ¨-1, 0âŸ© ;
  FâŸ¨"R",râŸ© : âŸ¨ 1, 0âŸ© ;
  "error" ! 1
}
UpdateTail â† {
  âŸ¨dx,dyâŸ© â† ğ•¨ -ğ•©
  ğ•© +Â¨ {
    1<|dxÃ—dy ? âŸ¨dxÃ·|dx,dyÃ·|dyâŸ© ;
    1<|dx    ? âŸ¨dxÃ·|dx,     0âŸ© ;
    1<|dy    ? âŸ¨0     ,dyÃ·|dyâŸ© ;
               âŸ¨0     ,0âŸ©
  }
}
Update â† {
  âŸ¨dir,0âŸ© F state : state ;
  âŸ¨dir,nâŸ© F âŸ¨head,tail,historyâŸ© :
    h â† head+DirVec ğ•¨
    t â† h UpdateTail tail
    âŸ¨dx,dyâŸ© â† h -tail
    âŸ¨dir,n-1âŸ© F âŸ¨h,t,{âŸ¨tâŸ©âŠ‘âˆ˜âˆŠhistory ? history ; âŸ¨tâŸ©âˆ¾history}âŸ©
}
Update2 â† {
  âŸ¨dir,0âŸ© F state : state ;
  âŸ¨dir,nâŸ© F âŸ¨knots,historyâŸ© :
    Propagate â† {
      last F âŸ¨âŸ© : âŸ¨âŸ© ;
      âŸ¨headâŸ©â€¿tail â† 1(â†‘â‹ˆâ†“)ğ•©
      h â† ğ•¨ UpdateTail head
      âŸ¨hâŸ©âˆ¾h Propagate tail
    }
    âŸ¨head,tailâŸ© â† (âŠ‘â‹ˆ1âŠ¸â†“)knots
    h â† head+DirVec ğ•¨
    t â† h Propagate tail
    âŸ¨dir,n-1âŸ©FâŸ¨âŸ¨hâŸ©âˆ¾t,{âŸ¨ğ•©âŸ©âŠ‘âˆ˜âˆŠhistory ? history ; âŸ¨ğ•©âŸ©âˆ¾history}âŠ‘âŒ½tâŸ©
}

Solve â‡ {envâ€¿part ğ•Š data :
  lib â† â€¢Import "/util.bqn"âˆ¾Ëœ"." env.VarâŒ¾â‹ˆ "BQN_LIB"
  moves â† (1âŠ¸â†‘â‹ˆ(lib.ParseInt 2âŠ¸â†“))Â¨data
  {1=part ? â‰ 2âŠ‘âŸ¨âŸ¨0,0âŸ©,âŸ¨0,0âŸ©,âŸ¨âŸ©âŸ©UpdateÂ´âŒ½moves ; â‰ 1âŠ‘âŸ¨âŸ¨0,0âŸ©Â¨â†•10,âŸ¨âŸ©âŸ©Update2Â´âŒ½moves}
}
