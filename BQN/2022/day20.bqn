Shift â† {i ğ•Š dataâ€¿nextâ€¿prev :
  jâ€¿step â† âŸ¨i,(Â¯1+â‰ data)||v â† iâŠ‘dataâŸ©
  j â†© {
     1=Ã—v ? {aâ†ğ•©âŠ‘nextâ‹„{a=i?aâŠ‘next;a}}âŸstep j ;
    Â¯1=Ã—v ? prevâŠ‘Ëœ{aâ†ğ•©âŠ‘prevâ‹„{a=i?aâŠ‘prev;a}}âŸstep j ;
    j
  }
  {
    0=step ? dataâ€¿nextâ€¿prev
    ;
      âŸ¨prev_i,next_i,next_jâŸ© â† âŸ¨iâŠ‘prev,iâŠ‘next,jâŠ‘nextâŸ©
      âŸ¨
        data
        next_jË™âŒ¾(iâŠ¸âŠ‘) iË™âŒ¾(jâŠ¸âŠ‘) next_iË™âŒ¾(prev_iâŠ¸âŠ‘) next
        prev_iË™âŒ¾(next_iâŠ¸âŠ‘) jË™âŒ¾(iâŠ¸âŠ‘) iË™âŒ¾(next_jâŠ¸âŠ‘) prev
      âŸ©
  }
}

Solve â‡ {envâ€¿part ğ•Š rawdata :
  lib â† â€¢Import "/util.bqn"âˆ¾Ëœ"." env.VarâŒ¾â‹ˆ "BQN_LIB"
  n â† â‰  data â† âˆ¾lib.parseIntsÂ¨rawdata
  âŸ¨next,prevâŸ© â† ((1âŠ¸+)(â‹ˆâ—‹(nâŠ¸|nâŠ¸+))(Â¯1âŠ¸+))â†•n
  dataâ€¿nextâ€¿Â· â†© { 1=part ? dataâ€¿nextâ€¿prev ShiftÂ´âŒ½â†•n ; {ğ•© ShiftÂ´âŒ½â†•n}âŸ10(811589153Ã—data)â€¿nextâ€¿prev}
  +Â´{dataâŠ‘Ëœ{ğ•©âŠ‘next}âŸğ•©âŠ‘dataâŠ<0}Â¨1000â€¿2000â€¿3000
}
