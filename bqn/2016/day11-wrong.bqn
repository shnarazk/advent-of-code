#!/usr/bin/env cbqn
numKinds â† 2
numStates â† 4â‹†1+2Ã—numKinds
# Element layout:
# - cost (0<)
MakeState â† âˆ`(â†•(4âŠ¸â‹†(1âŠ¸+(2âŠ¸Ã—))))
states â† MakeState numKinds
start â† 0
ToIndex â† (+âŸœ(4âŠ¸Ã—))Â´âŒ½
ToState â† {
    (Â¯1+Â¯2Ã—numKinds)â†‘ {
        F 0 : âŸ¨0âŸ© ;
        F n : {(F(n-ğ•©)Ã·4)âˆ¾ğ•©} 4|n
    } ğ•©
}
# Return 1 if ğ•© is safe for all microtips
IsSafe â† {
         F state : âŒŠÂ´stateâŠ¸(FËœ)Â¨â†•numKinds ;
    kind F state :
        floor â† (2+2Ã—kind)âŠ‘state
        generator â† 1+2Ã—kind
        (floor=generatorâŠ‘state)âˆ¨(âˆ§Â´{floor â‰  ğ•©âŠ‘state}Â¨1+2Ã—â†•numKinds)
}
# Returns the set of objects which you can move with elevator from the current floor.
NextObjectsStates â† {F state :
    Mask â† {
        (Â¯2Ã—numKinds)â†‘ {
            F 0 : âŸ¨0âŸ© ;
            F n : {(F(n-ğ•©)Ã·2)âˆ¾ğ•©} 2|n
        } ğ•©
    }
    objects â† {(âŠ‘ğ•©)âŠ¸=Â¨1â†“ğ•©}state
    cands â† ({âŒˆÂ´ğ•© âˆ§ objects=ğ•©}Â¨)âŠ¸/â·(objectsÃ—Mask)Â¨â†•2â‹†2Ã—numKinds
    {2 â‰¥ +Â´}Â¨âŠ¸/cands
    {s â† +Â´ğ•©â‹„ (1â‰¤s)âˆ§(sâ‰¤2)}Â¨âŠ¸/cands
}
# Returns the set of valid and safe states transited from the current state.
NextStates â† {F state :
    elevator â† âŠ‘state
    objects â† 1â†“state
    w â† NextObjectsStates state
    nextFloors â† {(0â‰¤ğ•©)âˆ§(ğ•©<4)}Â¨âŠ¸/âŸ¨Â¯1+elevator,1+elevatorâŸ©
    # â€¢Show â¥Š nextFloors {ğ•¨âˆ¾ ğ•¨Ã—ğ•©}âŒœ w
    cands â† â¥Š nextFloors{ğ•¨âˆ¾((Â¬ğ•©)Ã—objects)+ğ•¨Ã—ğ•©}âŒœw
    # â€¢Show IsSafeÂ¨ cands
    results â† IsSafeÂ¨âŠ¸/cands
    # â€¢Show âŸ¨>â‰ cands," => ",>â‰ resultsâŸ©
    results
}
SeekStep â† {cost F ii :
    init â† ToState ii
    {
        # â€¢Show âŸ¨"expand",ii,iiâŠ‘statesâŸ©
        nexts â† NextStates init
        # â€¢Show â‰  nexts
        {
            i â† ToIndex ğ•©
            âˆ = iâŠ‘states ?
                states â†© costË™âŒ¾(iâŠ¸âŠ‘)states
                # â€¢Show âŸ¨"update",i,iâŠ‘statesâŸ©
            ; @
        }Â¨ nexts
    }
}
Seek â† { ğ•¤
    len â† â‰ states
    indexes â† â†•len
    # cost â† 0
    p â† 0
    âŠ‘{ğ•Š cost :
        # â€¢Show "cost"â€¿costâ€¿(pÃ·len)
        {cost=ğ•©âŠ‘states ? (1+cost) SeekStep ğ•© â‹„ p + â†© 1 ; @}Â¨indexes
        1+cost
    }â€¢_while_{ğ•¤â‹„ âˆ=Â¯1âŠ‘states}0
}
# Part 1 Description: #####################################
# - 0: a hydrogen M, a lithium M.
# - 1: a hydrogen G.
# - 2: a lithium G.
# - 3: nothing relevant.
# Encode: hydrogen, lithium
# naive coding:
#     0â€¿0â€¿0â€¿0â€¿0
#     0â€¿0â€¿0â€¿1â€¿0
#     0â€¿1â€¿0â€¿0â€¿0
#     1â€¿0â€¿1â€¿0â€¿1
numKinds â†© 2
states â†© MakeState numKinds
start_state â† âŸ¨0, 1, 0, 2, 0âŸ©
â€¢Show (<"IsSafe")âˆ¾IsSafe start_state
start â†© ToIndex start_state
states â†© 0Ë™âŒ¾(startâŠ¸âŠ‘)states
â€¢Show {(ToState ğ•©)â€¿ğ•©â€¿(ToIndex ToState ğ•©)}start
"Fail to build the 1-arrow"!(ToStateâˆ˜ToIndex)âŠ¸(âˆ§Â´=)start_state
# â€¢Show NextStates ToState start
â€¢Show Seek @
# â€¢Show ToState 15
# â€¢Show 15âŠ‘states
# â€¢Show ToState 975
# â€¢Show 975âŠ‘states
# â€¢Show ToState 327
# â€¢Show 327âŠ‘states
# â€¢Show ToState 847
# â€¢Show 847âŠ‘states
# Part 1: #####################################
# - 0: a strontium G, a strontium M, a plutonium G, a plutonium M.
# - 1: a thulium G, a ruthenium G, a ruthenium M, a curium G, a curium M.
# - 2: a thulium M.
# - 3: nothing relevant.
# Encode: strontium, plutonium, thulium, ruthenium, curium
# numKinds â†© 5
# states â†© MakeState numKinds
# start â†© ToIndex âŸ¨0, 0, 0, 0, 0, 1, 2, 1, 1, 1, 1âŸ©
# states â†© 0Ë™âŒ¾(startâŠ¸âŠ‘) states
# â€¢Show Seek @
# Part 2: #####################################
numKinds â†© 1
states â†© MakeState numKinds
start â†© ToIndexâŸ¨0,0,0âŸ©
states â†© 0Ë™âŒ¾(startâŠ¸âŠ‘)states
â€¢Show Seek @
numKinds â†© 2
states â†© MakeState numKinds
start â†© ToIndexâŸ¨0,0,0,0,0âŸ©
states â†© 0Ë™âŒ¾(startâŠ¸âŠ‘)states
â€¢Show Seek @
numKinds â†© 3
states â†© MakeState numKinds
start â†© ToIndexâŸ¨0,0,0,0,0,0,0âŸ©
states â†© 0Ë™âŒ¾(startâŠ¸âŠ‘)states
â€¢Show Seek @
numKinds â†© 4
states â†© MakeState numKinds
start â†© ToIndexâŸ¨0,0,0,0,0,0,0,0,0âŸ©
states â†© 0Ë™âŒ¾(startâŠ¸âŠ‘)states
â€¢Show Seek@
