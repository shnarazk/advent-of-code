Solve ⇐ {env‿part 𝕊 data :
  util ← •Import "/util.bqn"∾˜ "," env.Var⌾⋈ "BQN_LIB"
  Ext ← {𝕊 x : (1⊸⌽∞⊸»⍟2)⎉1{𝔽 _𝕣 𝕩 : 𝔽⌾⍉𝔽 𝕩}(2+≢)⊸↑x ; 𝕊⁼𝕩 : (¯2+≢)⊸↑1⌽⎉1 1⌽𝕩}
  Shift ← (1+×∘⊣)◶⟨∞⊸«,⊢,∞⊸»⟩
  adjacents ← ⟨0‿0,1‿0,¯1‿0,0‿1,0‿¯1⟩
  map ← util.ParseInt∘⋈¨>data
  Gather ← {∾¨´adjacents Shift{y‿x 𝔽 _𝕣 𝕩 : y⊸𝔽⎉1⌾⍉x⊸𝔽⎉1 𝕩}¨<𝕩}⌾Ext
  neighbors ← Gather map
  lows ← {∧´<´1⊸(⊑∘↑⋈↓)𝕩}¨neighbors
  {
    1=part ? +´lows×○⥊1+map ;
    ×´3↑∨≠¨⊔(∞⊸≠)⊸/⥊{𝕊 basin : map{𝕩÷9>𝕨}¨⌊´¨Gather basin}⍟(+´≢)((1÷⊢)⌈(⊢×+`))⌾⥊lows
  }
}
