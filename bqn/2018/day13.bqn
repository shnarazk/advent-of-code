Solve â‡ {envâ€¿part ğ•Š data :
  util â† â€¢Import "/util.bqn"âˆ¾Ëœ"." env.VarâŒ¾â‹ˆ "BQN_LIB"
  dir â† âŸ¨Â¯1â€¿0,0â€¿Â¯1,0â€¿1,1â€¿0âŸ©
  symbol â† " /-\|+^<>v"
  # util.Debug >âŸ¨âŸ©âŠ¸â‰¢Â¨âŠ¸/data
  data (>âŸ¨âŸ©âŠ¸â‰¢Â¨âŠ¸/) â†©
  data symbolâŠ¸âŠâŒ¾â‹ˆÂ¨ â†©
  Clash â† â‰ â—‹â‰ âŸœâ·âŠ‘Â¨
  Display â† {ğ•¨ util.Debug âŠ‘âŸœsymbolÂ¨data{posâ€¿orâ€¿n ğ•Š map : orâŒ¾(posâŠ¸âŠ‘)map}Â´ğ•© â‹„ ğ•©}
  {
    1=part ?
      Next â† {
        x â† (0=ğ•¨)â—¶âŸ¨âŠ¢,âˆ§âŸ©ğ•© # x â‰¢ posâ€¿orientationâ€¿number_of_turns
        "# ğ•¨" util.Debug posâ€¿orientationâ€¿turns â† ğ•¨âŠ‘x
        "# newpos" util.Debug newpos â† pos+ d â† âŠ‘âŸœdir os â† orientation-6
        os â†© {
           0 : os ;
           1 : "# turn"âŠ¸util.DebugâŠ‘âŸœâŸ¨2,3,0,1âŸ©os ; # / âŸ¨Â¯1â€¿0,0â€¿Â¯1,0â€¿1,1â€¿0âŸ©
           2 : os ;
           3 : "# turn"âŠ¸util.DebugâŠ‘âŸœâŸ¨1,0,3,2âŸ©os ; # \ âŸ¨Â¯1â€¿0,0â€¿Â¯1,0â€¿1,1â€¿0âŸ©
           4 : os ;
           5 : "# cross"âŠ¸util.Debug (turns (3|1âŠ¸+) â†©)âŠ¸âŠ‘âŠ‘âŸœâŸ¨âŸ¨2,1,0âŸ©,âŸ¨0,3,1âŸ©,âŸ¨3,0,2âŸ©,âŸ¨1,2,3âŸ©âŸ©os ;      # up,left,right,downâ‰left,straight,right
           ğ•© : os
        }newposâŠ‘data
        "# next" util.Debug âŸ¨newpos,6+os,turnsâŸ©âŒ¾(ğ•¨âŠ¸âŠ‘)x
        # ğ•¨ Display âŸ¨newpos,6+os,turnsâŸ©âŒ¾(ğ•¨âŠ¸âŠ‘)x
      }
      n â† â‰  carts â† âˆ§âˆ¾{(â‹ˆâˆ¾âŸ¨ğ•©,0âŸ©Ë™)Â¨(ğ•©=âŠ‘âŸœdata)Â¨âŠ¸/â¥Šâ†•â‰¢data}Â¨6+â†•4
      âŒ½âŠ‘âŠ‘â‰¡Â´Â¨âŠ¸/<Ë˜2â†•âˆ§âŠ‘Â¨âŠ‘{câ€¿i : âŸ¨i Next c,n|i+1âŸ©}â€¢_while_(Â¬âˆ˜Clash âŠ‘)cartsâ€¿0
    ;
      k â† 0
      Next â† {
        {20=k ? â€¢Exit 0 ; @}
        w â† (â‰ ğ•©)âŠ¸|ğ•¨
        x â† ğ•© # x â‰¢ posâ€¿orientationâ€¿number_of_turns
        {0=ğ•¨ ? x â†© âˆ§âˆâŠ¸â‰¢Â¨âŠ¸/x ; @}
        {
          âˆâ‰¡wâŠ‘x ? x ;
          posâ€¿orientationâ€¿turns â† wâŠ‘x
          newpos â† pos+ d â† âŠ‘âŸœdir os â† orientation-6
          os â†© {
             0 : os ;
             1 : "# turn"âŠ¸util.DebugâŠ‘âŸœâŸ¨2,3,0,1âŸ©os ; # / âŸ¨Â¯1â€¿0,0â€¿Â¯1,0â€¿1,1â€¿0âŸ©
             2 : os ;
             3 : "# turn"âŠ¸util.DebugâŠ‘âŸœâŸ¨1,0,3,2âŸ©os ; # \ âŸ¨Â¯1â€¿0,0â€¿Â¯1,0â€¿1,1â€¿0âŸ©
             4 : os ;
             5 : "# cross"âŠ¸util.Debug (turns (3|1âŠ¸+) â†©)âŠ¸âŠ‘âŠ‘âŸœâŸ¨âŸ¨2,1,0âŸ©,âŸ¨0,3,1âŸ©,âŸ¨3,0,2âŸ©,âŸ¨1,2,3âŸ©âŸ©os ;
             ğ•© : os
          }newposâŠ‘data
          next â† âŸ¨newpos,6+os,turnsâŸ©âŒ¾(wâŠ¸âŠ‘)x
          clashes â† âŠ‘Â¨â‰¡Â´Â¨âŠ¸/â¥Š<Ë˜2â†•âˆ§âŠ‘Â¨next
          clashlist â† (âˆŠâŸœclashesâŒ¾â‹ˆâŠ‘)Â¨next
          util.Progress â‰ âˆâŠ¸â‰¢Â¨âŠ¸/next
          clashlist{0 ğ•Š ğ•© : ğ•© ; 1 ğ•Š ğ•© : âˆ}Â¨next
        }
      }
      carts â† âˆ§âˆ¾{(â‹ˆâˆ¾âŸ¨ğ•©,0âŸ©Ë™)Â¨(ğ•©=âŠ‘âŸœdata)Â¨âŠ¸/â¥Šâ†•â‰¢data}Â¨6+â†•4
      âŒ½âŠ‘âŠ‘âˆâŠ¸â‰¢Â¨âŠ¸/âŠ‘{câ€¿i : âŸ¨i Next c,i+1âŸ©}â€¢_while_(1<(+Â´Â·âˆâŠ¸â‰¢Â¨âŠ‘))cartsâ€¿0

  }
}
