_under_ â† {
    ğ”½ _ğ•£_ ğ”¾ ğ•© :  ğ”½ğ”¾ğ•© â‹„ ğ•© ;
  ğ•¨ ğ”½ _ğ•£_ ğ”¾ ğ•© : ğ•¨ğ”½ğ”¾ğ•© â‹„ ğ•©
}
Solve â‡ {envâ€¿part ğ•Š data :
  utilâ€¿geo â† â€¢ImportÂ¨"/util.bqn"â€¿"/geometry.bqn"âˆ¾ËœÂ¨<"." env.VarâŒ¾â‹ˆ "BQN_LIB"
  Distance â† {(âŠ¢âŒŠğ•¨{ğ•¨â—¶âŸ¨âˆ,âŠ¢âŸ©ğ•©}Â¨(1+âŒŠÂ´Â¨âˆ˜(âˆâŠ¸geo.Neighbor4)))âŸ(2Ã—(â‰ ğ•¨))(-ğ•©) geo.Rotate 0âŒ¾(0â€¿0âŠ¸âŠ‘)âˆÂ¨ğ•¨}
  symbols â† ".#EG"
  data (âŸ¨âŸ©âŠ¸â‰¢Â¨âŠ¸/)âˆ˜(' 'âŠ¸â‰ Â¨âŠ¸/Â¨) â†©
  data symbolsâŠ¸âŠâˆ˜> â†©
  blocks â† (1=âŠ‘âŸœdata)Â¨â†•â‰¢data
  elf_hitpoint â† 200
  goblin_hitpoint â† 200
  attackÂ¯power â† 3
  chars â† â†•âˆ˜â‰ âŠ¸(â‹ˆâŠ¸âˆ¾Â¨){
    "â‰ elves" util.Debug â‰ elves â† {âŸ¨ğ•©,2,elf_hitpointâŸ©}Â¨(2=âŠ‘âŸœdata)Â¨âŠ¸/â¥Šâ†•â‰¢data
    "â‰ goblins" util.Debug â‰ goblins â† {âŸ¨ğ•©,3,goblin_hitpointâŸ©}Â¨(3=âŠ‘âŸœdata)Â¨âŠ¸/â¥Šâ†•â‰¢data
    elvesâˆ¾goblins
  }
  shape â† â‰¢data
  CurrentMap â† {blocks{iâ€¿posâ€¿sâ€¿hp ğ•Š ğ•©: (0<hp)â—¶âŸ¨âŠ¢,sâŒ¾(posâŠ¸âŠ‘)âŸ©ğ•©}Â´ğ•©}
  Show â† {
    ğ•Š ğ•© : 2==ğ•© ? âˆ§Â´â¥Š((3âŠ¸â‰¥)âˆ§1=â€¢Type)Â¨ğ•© ? util.Debug âŠ‘âŸœsymbolsÂ¨ğ•© â‹„ ğ•©  ;
    ğ•Š ğ•© : 2==ğ•© ? â€¢Show ğ•© â‹„ ğ•©  ;
    ğ•Š ğ•© : 1==ğ•© ? 8<â‰ ğ•© ? âˆ§Â´â‰¡â—‹â‰ Â´Ë˜2â†•ğ•© ? util.Debug â‰â‰ğ•© â‹„ ğ•©  ;
    ğ•Š ğ•© : util.Debug ğ•© ;
    ğ•¨ ğ•Š ğ•© :
      2==ğ•© ? âˆ§Â´â¥Š((3âŠ¸â‰¥)âˆ§1=â€¢Type)Â¨ğ•© ? ğ•¨ util.Debug âŠ‘âŸœsymbolsÂ¨ğ•© â‹„ ğ•©  ;
      2==ğ•© ? ğ•¨ util.Debug ğ•© â‹„ ğ•©  ;
      1==ğ•© ? 8<â‰ ğ•© ? âˆ§Â´â‰¡â—‹â‰ Â´Ë˜2â†•ğ•© ? ğ•¨ util.Debug â‰â‰ğ•© â‹„ ğ•© ;
      1    ? ğ•¨ util.Debug ğ•©
  }
  Act â† {
    i ğ•Š chars  :
      "turn" Show idâ€¿posâ€¿speciesâ€¿hitpoint â† iâŠ‘chars
      0<hitpoint ?
      "enemytype" Show enemytype â† Â¬âŒ¾(-âŸœ2)species
      livings â† (0<3âŠ¸âŠ‘)Â¨âŠ¸/chars
      pol â† 1âŠ¸âŠ‘Â¨livings
      current_open â† 1âŒ¾(posâŠ¸âŠ‘)Â¬((âˆŠâŸœpolâŒ¾â‹ˆ)âˆ¨(âŠ‘âŸœblocks))Â¨â†•shape
      âŸ¨âŸ©â‰¢targets â† (enemytype=2âŠ¸âŠ‘)Â¨âŠ¸/livings ?
      "targets" Show targets
      "enemymap" Show enemymap â† âˆŠâŸœ(1âŠ¸âŠ‘Â¨targets)â†•shape
      "RoT" Show rangeoftargets â† âˆ§â·âˆ¾(â¥Šcurrent_open)/â¥Šenemymap{ğ•¨â—¶âŸ¨âŸ¨âŸ©,âŠ¢âŸ©ğ•©}Â¨âˆâŠ¸â‰¢Â¨âŠ¸/Â¨âˆ geo.Neighbor4 â†•shape
      (âˆ¨Â´(0=âŠ‘âŸœdata)Â¨rangeoftargets) ?
      destination â† pos
      {
        Â¬âˆŠâŸœrangeoftargetsâŒ¾â‹ˆpos ?
        d â† current_open Distance pos
        "destination" Show destination â†© âŸ¨âŸ©âŠ¸â‰¢â—¶âŸ¨âŠ¢,1âŠ¸âŠ‘âŠ‘âŸ©âˆ§(âˆâ‰ âŠ‘)Â¨âŠ¸/{ğ•©â‹ˆËœğ•©âŠ‘d}Â¨rangeoftargets
        ; @
      }
      âŸ¨âŸ©â‰¢destination ?
      path â† current_open Distance destination
      "check" Show posâŠ‘âˆ geo.Neighbor4 â†•shape
      newpos â† âŠ‘âˆ§âˆâŠ¸â‰¢Â¨âŠ¸/posâŠ‘âˆ geo.Neighbor4 â†•shape
      "move to" Show pos â†© newpos
      chars posâŒ¾(1âŠ¸âŠ‘idâŠ¸âŠ‘) â†©
      adjacents â† âˆâŠ¸â‰¢âŠ¸/pos âŠ‘âˆ geo.Neighbor4 â†•shape
      {
        âŸ¨âŸ©â‰¢attackabletargets â† ((âˆŠâŸœadjacents)âŒ¾â‹ˆ1âŠ¸âŠ‘)Â¨âŠ¸/targets ?
        "weakest target to attack" Show target â† attackabletargetsâŠ‘ËœâŠ‘â‹(2â€¿0âŠ¸âŠ)Â¨attackabletargets
        "reduced to" Show _under_(3âŠ¸âŠ‘(âŠ‘target)âŠ¸âŠ‘) chars (0âŒˆ-âŸœattackÂ¯power)âŒ¾(3âŠ¸âŠ‘(âŠ‘target)âŠ¸âŠ‘) â†©
        ;
        @
      }
      chars
      ;
    ğ•¨ ğ•Š ğ•© : ğ•©
  }
  {
    1=part ?
      Ã—âŸœ(âŒˆÂ´)Â´{ğ•Š turnâ€¿points:
        order â† â‹(1âŠ¸âŠ‘)Â¨(0<3âŠ¸âŠ‘)Â¨âŠ¸/chars
        "Act" Show âˆ§chars â†© chars ActÂ´âŒ½order
        5 util.Progress âŠ‘âŸœsymbolsÂ¨CurrentMap chars
        "elves points" Show ep â† +Â´(3âŠ¸âŠ‘)Â¨(2=2âŠ¸âŠ‘)Â¨âŠ¸/chars
        "goblin points" Show gp â† +Â´(3âŠ¸âŠ‘)Â¨(3=2âŠ¸âŠ‘)Â¨âŠ¸/chars
        âŸ¨turn+1,epâ‹ˆgpâŸ©
      }â€¢_while_(0<âŒŠÂ´âˆ˜(1âŠ¸âŠ‘))âŸ¨0,1â€¿1âŸ©
      ;
    0
  }
}
