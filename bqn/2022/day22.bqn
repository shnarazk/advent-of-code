Solve â‡ {envâ€¿part ğ•Š data :
  util â† â€¢Import "/util.bqn"âˆ¾Ëœ"." env.VarâŒ¾â‹ˆ "BQN_LIB"
  width â† âŒˆÂ´â‰ Â¨Â¯1â†“data
  "map size" util.Debug â‰¢map â† >widthâŠ¸â†‘Â¨Â¯2â†“data
  "# map" util.Debug map
  unit_size â† mapâ‰ âŠ¸Ã·4
  map â†© Â¯1âŒ½â‰2 Â¯1âŒ½â‰1(2+â‰¢map)â†‘map
  "# horizontal slice 0" util.Debug âŠâ‰2 map
  "# horizontal slice 1" util.Debug 1âŠâ‰2 map
  "# vertical slice 0" util.Debug âŠâ‰1 map
  "# vertical slice 2" util.Debug 2âŠâ‰1 map
  Warp â† {loc ğ•Š vec :
    âŸ¨Â¯1, 0âŸ©â‰¡ğ•© ? (1âŠ‘ğ•¨)âˆ¾ËœÂ¯1âŠ‘1âŠ‘âŠ”' 'â‰ (1âŠ‘ğ•¨)âŠâ‰1 map ;
    âŸ¨ 1, 0âŸ©â‰¡ğ•© ? (1âŠ‘ğ•¨)âˆ¾Ëœ  âŠ‘1âŠ‘âŠ”' 'â‰ (1âŠ‘ğ•¨)âŠâ‰1 map ;
    âŸ¨ 0,Â¯1âŸ©â‰¡ğ•© ? ( âŠ‘ğ•¨)âˆ¾ Â¯1âŠ‘1âŠ‘âŠ”' 'â‰ ( âŠ‘ğ•¨)âŠâ‰2 map ;
    âŸ¨ 0, 1âŸ©â‰¡ğ•© ? ( âŠ‘ğ•¨)âˆ¾   âŠ‘1âŠ‘âŠ”' 'â‰ ( âŠ‘ğ•¨)âŠâ‰2 map ;
    !0
  }
  "# path" util.Debug (20âŒŠâ‰ )âŠ¸â†‘path â† âˆ¾âŸœ"â†’"Â¯1âŠ‘data
  "# parse" util.Debug (+`pathâˆŠ"LRâ†’")
  "# group" util.Debug (0âˆ¾Â·<Â´Â¨Â·â¥ŠÂ·<Ë˜2âŠ¸â†•)âŠ¸(-Ëœ)"# scan sum" util.Debug+`pathâˆŠ"LRâ†’"
  "# route" util.Debug Â¯1âŠ¸(util.ParseIntâˆ˜â†“â‹ˆâŠ‘)Â¨((0âˆ¾Â·<Â´Â¨Â·â¥ŠÂ·<Ë˜2âŠ¸â†•)âŠ¸(-Ëœ)+`pathâˆŠ"LRâ†’")âŠ”path
  route â† Â¯1âŠ¸(util.ParseIntâˆ˜â†“â‹ˆ{-Â¬âŠ‘"Lâ†’R"âŠ¸âŠğ•©}âˆ˜âŠ‘)Â¨((0âˆ¾Â·<Â´Â¨Â·â¥ŠÂ·<Ë˜2âŠ¸â†•)âŠ¸(-Ëœ)+`pathâˆŠ"LRâ†’")âŠ”path
  "start" util.Debug start â† 1âˆ¾âŠ‘"."âŠ’Ëœ1âŠmap
  Move â† {distâ€¿turn ğ•Š locâ€¿dir :
    vec â† dirâŠ‘âŸ¨Â¯1â€¿0,0â€¿1,1â€¿0,0â€¿Â¯1âŸ©
    {
      '.'â‰¡(n â† vec+loc)âŠ‘map ? loc â†© nâ‹„ -Â¬ğ•© ;
      '#'â‰¡(n â† vec+loc)âŠ‘map ? 0 ;
      newloc â† loc Warp vec
      count â† ğ•©
      {'.'â‰¡newlocâŠ‘map ? loc â†© newloc â‹„ -Â¬count ; '#'â‰¡newlocâŠ‘map ? 0 ; !0}
    }â€¢_while_(0âŠ¸<)dist
    âŸ¨loc, 4|4+dir+turnâŸ©
  }
  # divide world into 6 patches
  # p01,p02,p11,p20,p21,p30
  # p00 â† â‰p20
  # p10 â†
  Move2 â† {distâ€¿turn ğ•Š locâ€¿dir :
    {
      vec â† dirâŠ‘âŸ¨Â¯1â€¿0,0â€¿1,1â€¿0,0â€¿Â¯1âŸ©
      '.'â‰¡(n â† vec+loc)âŠ‘map ? loc â†© n â‹„ -Â¬ğ•© ;
      vec â† dirâŠ‘âŸ¨Â¯1â€¿0,0â€¿1,1â€¿0,0â€¿Â¯1âŸ©
      '#'â‰¡(n â† vec+loc)âŠ‘map ? 0 ;
      patch â† (Â¯1+loc)âŒŠâˆ˜Ã·unit_size
      dyâ€¿dx â† unit_size|Â¯1+loc # back to zero-indexed space
      # patch_no.â€¿dir â†’ worp target positioni
      e â† unit_size-1
      o â† âŸ¨1,1âŸ©
      newlocâ€¿newdir â† {
        # vertical warp
        âŸ¨0,1âŸ©â€¿0 : âŸ¨o+âŸ¨dx,  0âŸ©+unit_sizeÃ—3â€¿0,1âŸ© ;
        âŸ¨0,2âŸ©â€¿0 : âŸ¨o+âŸ¨0,  dxâŸ©+unit_sizeÃ—3â€¿0,0âŸ© ;
        âŸ¨0,2âŸ©â€¿2 : âŸ¨o+âŸ¨dx,  eâŸ©+unit_sizeÃ—1â€¿1,3âŸ© ;
        âŸ¨2,0âŸ©â€¿0 : âŸ¨o+âŸ¨dx,  0âŸ©+unit_sizeÃ—1â€¿1,1âŸ© ;
        âŸ¨2,1âŸ©â€¿2 : âŸ¨o+âŸ¨dx,  eâŸ©+unit_sizeÃ—3â€¿0,3âŸ© ;
        âŸ¨3,0âŸ©â€¿2 : âŸ¨o+âŸ¨dx,  0âŸ©+unit_sizeÃ—0â€¿2,2âŸ© ;
        # horizontal warp
        âŸ¨0,1âŸ©â€¿3 : âŸ¨o+âŸ¨e-dy,0âŸ©+unit_sizeÃ—2â€¿0,1âŸ© ;
        âŸ¨0,2âŸ©â€¿1 : âŸ¨o+âŸ¨e-dy,0âŸ©+unit_sizeÃ—2â€¿1,3âŸ© ;
        âŸ¨1,1âŸ©â€¿3 : âŸ¨o+âŸ¨0,  dyâŸ©+unit_sizeÃ—2â€¿0,2âŸ© ;
        âŸ¨1,1âŸ©â€¿1 : âŸ¨o+âŸ¨e,  dyâŸ©+unit_sizeÃ—0â€¿2,0âŸ© ;
        âŸ¨2,0âŸ©â€¿3 : âŸ¨o+âŸ¨e-dy,0âŸ©+unit_sizeÃ—0â€¿1,1âŸ© ;
        âŸ¨2,1âŸ©â€¿1 : âŸ¨o+âŸ¨e-dy,eâŸ©+unit_sizeÃ—0â€¿2,3âŸ© ;
        âŸ¨3,0âŸ©â€¿3 : âŸ¨o+âŸ¨0,  dyâŸ©+unit_sizeÃ—0â€¿1,2âŸ© ;
        âŸ¨3,0âŸ©â€¿1 : âŸ¨o+âŸ¨e,  dyâŸ©+unit_sizeÃ—2â€¿1,0âŸ© ;
        (ğ•©â‹ˆloc)!0
      }patchâ€¿dir
      count â† ğ•©
      "newloc" util.Debug newloc
      {'.'â‰¡newlocâŠ‘map ? locâ€¿dir â†© newlocâ€¿newdir â‹„ -Â¬count ; '#'â‰¡newlocâŠ‘map ? 0 ; !0}
    }â€¢_while_(0âŠ¸<)dist
    âŸ¨loc, 4|4+dir+turnâŸ©
  }
  {
    1=part ? {(yâ€¿x)â€¿dir : "goal" util.Debug ğ•© â‹„ (4|3+dir)+(4Ã—x)+1000Ã—y}startâ€¿1 MoveÂ´âŒ½route ;
    {(yâ€¿x)â€¿dir : "goal" util.Debug ğ•© â‹„ (4|3+dir)+(4Ã—x)+1000Ã—y}startâ€¿1 Move2Â´âŒ½route
  }
}
