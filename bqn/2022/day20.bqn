#!/usr/bin/env cbqn
lib â† â€¢Import "../lib.bqn"
n â† â‰ data â† âˆ¾lib.parseIntsÂ¨ â€¢Flines "data/2022/input-day20.txt" lib.DataFile âŸ¨âŸ© # â€¢args
âŸ¨next, prevâŸ© â† ((1âŠ¸+)(â‹ˆâ—‹(nâŠ¸|nâŠ¸+))(Â¯1âŠ¸+)) â†•n
Shift â† { ğ•Š i: 
  j â† i
  step â† (Â¯1+n)||v â† iâŠ‘data 
  j â†© {
    1=Ã—v ? {aâ†ğ•©âŠ‘nextâ‹„{a=i?aâŠ‘next;a}}âŸstep j;
    Â¯1=Ã—v? prevâŠ‘Ëœ{aâ†ğ•©âŠ‘prevâ‹„{a=i?aâŠ‘prev;a}}âŸstep j;
    j
  }
  {
    0=step ? @;
    prev_i â† iâŠ‘prev
    next_i â† iâŠ‘next
    next_j â† jâŠ‘next
    next â†© next_iË™âŒ¾(prev_iâŠ¸âŠ‘) next
    next â†© iË™âŒ¾(jâŠ¸âŠ‘) next
    next â†© next_jË™âŒ¾(iâŠ¸âŠ‘) next
    prev â†© iË™âŒ¾(next_jâŠ¸âŠ‘) prev
    prev â†© jË™âŒ¾(iâŠ¸âŠ‘) prev
    prev â†© prev_iË™âŒ¾(next_iâŠ¸âŠ‘) prev
  }
}
z â† âŠ‘data âŠ <0
Trace â† { dataâŠ‘Ëœ{ğ•©âŠ‘next}âŸğ•© z }
Print â† {
  â€¢Out "print"
  {â€¢Show ğ•©âŠ‘dataâ‹„ ğ•©âŠ‘next}âŸn ğ•©
  â€¢Out "end"
  @
}
ShiftÂ¨ â†•n
# â€¢Show Print z
â€¢Show +Â´TraceÂ¨ 1000â€¿2000â€¿3000 
