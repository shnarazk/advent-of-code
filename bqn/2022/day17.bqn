Solve â‡ {envâ€¿part ğ•Š data :
  lib â† "." env.VarâŒ¾â‹ˆ "BQN_LIB"
  utilâ€¿âŸ¨HashMapâŸ©â€¿âŸ¨HashSetâŸ© â† â€¢ImportÂ¨"/util.bqn"â€¿"/hashmap.bqn"â€¿"/hashset.bqn"âˆ¾ËœÂ¨<lib
  "# shapes" util.Debug shapes â† [
    shape0 â† <[1â€¿1â€¿1â€¿1]
    shape1 â† <[0â€¿1â€¿0,1â€¿1â€¿1,0â€¿1â€¿0]
    shape2 â† <[0â€¿0â€¿1,0â€¿0â€¿1,1â€¿1â€¿1]
    shape3 â† <[âŸ¨1âŸ©,âŸ¨1âŸ©,âŸ¨1âŸ©,âŸ¨1âŸ©]
    shape4 â† <[1â€¿1,1â€¿1]
  ]
  _in_ â† {ğ•¨ ğ”½ _ğ•£_ ğ”¾ ğ•© : diff â† ğ•¨-â—‹(ğ•—âŠ¸âŠ‘)ğ•© â‹„ ((diffâ‰¥âŠ£)âˆ§(diffâ‰¤âŠ¢))Â´ğ•˜}
  ! 0â€¿0 (0)_in_(Â¯2â€¿2) 1â€¿0
  Clashes â† {
    0â€¿(yâ€¿x) ğ•Š âŸ¨âŸ©    : (0>x)âˆ¨(3<x) ;
    1â€¿(yâ€¿x) ğ•Š âŸ¨âŸ©    : (0>x)âˆ¨(4<x) ;
    2â€¿(yâ€¿x) ğ•Š âŸ¨âŸ©    : (0>x)âˆ¨(4<x) ;
    3â€¿(yâ€¿x) ğ•Š âŸ¨âŸ©    : (0>x)âˆ¨(6<x) ;
    4â€¿(yâ€¿x) ğ•Š âŸ¨âŸ©    : (0>x)âˆ¨(5<x) ;
    0â€¿pos1 ğ•Š 0â€¿pos2 : (pos1(0)_in_âŸ¨0,0âŸ©pos2)âˆ§(pos1(1)_in_âŸ¨Â¯3,3âŸ©pos2) ;
    0â€¿pos1 ğ•Š 1â€¿pos2 :
      âˆ¨Â´âŸ¨
          (pos1(0)_in_âŸ¨0,2âŸ©pos2)âˆ§(pos1(1)_in_âŸ¨Â¯2,1âŸ©pos2)     #horizontal-to-vertical
          (pos1(0)_in_âŸ¨1,1âŸ©pos2)âˆ§(pos1(1)_in_âŸ¨Â¯3,2âŸ©pos2)     # horizontal bars
        âŸ©
      ;
    0â€¿pos1 ğ•Š 2â€¿pos2 :
      âˆ¨Â´âŸ¨
          (pos1(0)_in_âŸ¨0,0âŸ©pos2)âˆ§(pos1(1)_in_âŸ¨Â¯3,2âŸ©pos2)     # horizontal bars
          (pos1(0)_in_âŸ¨0,2âŸ©pos2)âˆ§(pos1(1)_in_âŸ¨Â¯1,2âŸ©pos2)     # horizontal-to-vertical
        âŸ©
      ;
    0â€¿pos1 ğ•Š 3â€¿pos2 : (pos1(0)_in_âŸ¨0,3âŸ©pos2)âˆ§(pos1(1)_in_âŸ¨Â¯3,0âŸ©pos2) ;
    0â€¿pos1 ğ•Š 4â€¿pos2 :
        âˆ¨Â´âŸ¨
            (pos1(0)_in_âŸ¨0,1âŸ©pos2)âˆ§(pos1(1)_in_âŸ¨Â¯3,0âŸ©pos2)   # horizontal-to-left_bar
            (pos1(0)_in_âŸ¨0,1âŸ©pos2)âˆ§(pos1(1)_in_âŸ¨Â¯2,1âŸ©pos2)   # horizontal-to-right_bar
          âŸ©
        ;
    1â€¿pos1 ğ•Š 1â€¿pos2 :
      âˆ¨Â´âŸ¨
          (pos1(0)_in_âŸ¨0,0âŸ©pos2)âˆ§(pos1(1)_in_âŸ¨Â¯2,2âŸ©pos2)      # horizontal bars
          (pos1(0)_in_âŸ¨Â¯2,2âŸ©pos2)âˆ§(pos1(1)_in_âŸ¨0,0âŸ©pos2)      # vertical bars
          (pos1(0)_in_âŸ¨Â¯1,1âŸ©pos2)âˆ§(pos1(1)_in_âŸ¨Â¯1,1âŸ©pos2)     # horizontal-to-vertical and vice-veca
        âŸ©
      ;
    1â€¿pos1 ğ•Š 2â€¿pos2 :
      âˆ¨Â´âŸ¨
          (pos1(0)_in_âŸ¨Â¯1,Â¯1âŸ©pos2)âˆ§(pos1(1)_in_âŸ¨Â¯2,2âŸ©pos2)    # horizontal bars
          (pos1(0)_in_âŸ¨Â¯2,2âŸ©pos2)âˆ§(pos1(1)_in_âŸ¨1,1âŸ©pos2)      # vertical bars
          (pos1(0)_in_âŸ¨Â¯1,1âŸ©pos2)âˆ§(pos1(1)_in_âŸ¨0,2âŸ©pos2)      # horizontal-to-vertical
          (pos1(0)_in_âŸ¨Â¯2,0âŸ©pos2)âˆ§(pos1(1)_in_âŸ¨Â¯1,1âŸ©pos2)     # vertical-to-horizontal
        âŸ©
      ;
    1â€¿pos1 ğ•Š 3â€¿pos2 :
      âˆ¨Â´âŸ¨
          (pos1(0)_in_âŸ¨Â¯1,2âŸ©pos2)âˆ§(pos1(1)_in_âŸ¨Â¯2,0âŸ©pos2)     # horizontal-to-vertical
          (pos1(0)_in_âŸ¨Â¯2,3âŸ©pos2)âˆ§(pos1(1)_in_âŸ¨Â¯1,Â¯1âŸ©pos2)    # vertical bars
        âŸ©
      ;
    1â€¿pos1 ğ•Š 4â€¿pos2 :
      âˆ¨Â´âŸ¨
          (pos1(0)_in_âŸ¨Â¯1,0âŸ©pos2)âˆ§(pos1(1)_in_âŸ¨Â¯2,0âŸ©pos2)     # horizontal-to-left_bar
          (pos1(0)_in_âŸ¨Â¯1,0âŸ©pos2)âˆ§(pos1(1)_in_âŸ¨Â¯1,1âŸ©pos2)     # horizontal-to-right_bar
          (pos1(0)_in_âŸ¨Â¯2,1âŸ©pos2)âˆ§(pos1(1)_in_âŸ¨Â¯1,Â¯1âŸ©pos2)    # vertical-to-left_bar
          (pos1(0)_in_âŸ¨Â¯2,1âŸ©pos2)âˆ§(pos1(1)_in_âŸ¨0,0âŸ©pos2)      # vertical-to-right_bar
        âŸ©
       ;
    1â€¿pos1 ğ•Š 0â€¿pos2 : 0â€¿pos2 ğ•Š 1â€¿pos1 ;
    2â€¿pos1 ğ•Š 2â€¿pos2 :
      âˆ¨Â´âŸ¨
          (pos1(0)_in_âŸ¨0,0âŸ©pos2)âˆ§(pos1(1)_in_âŸ¨Â¯2,2âŸ©pos2)      # horizontal bars
          (pos1(0)_in_âŸ¨Â¯2,2âŸ©pos2)âˆ§(pos1(1)_in_âŸ¨0,0âŸ©pos2)      # vertical bars
          (pos1(0)_in_âŸ¨0,2âŸ©pos2)âˆ§(pos1(1)_in_âŸ¨0,2âŸ©pos2)       # horizontal-to-vertical
          (pos1(0)_in_âŸ¨Â¯2,0âŸ©pos2)âˆ§(pos1(1)_in_âŸ¨Â¯2,0âŸ©pos2)     # vertical-to-horizontal
        âŸ©
      ;
    2â€¿pos1 ğ•Š 3â€¿pos2 :
      âˆ¨Â´âŸ¨
          (pos1(0)_in_âŸ¨0,3âŸ©pos2)âˆ§(pos1(1)_in_âŸ¨Â¯2,0âŸ©pos2)      # horizontal-to-vertical
          (pos1(0)_in_âŸ¨Â¯2,3âŸ©pos2)âˆ§(pos1(1)_in_âŸ¨Â¯2,Â¯2âŸ©pos2)    # vertical bars
       âŸ©
      ;
    2â€¿pos1 ğ•Š 4â€¿pos2 :
      âˆ¨Â´âŸ¨
          (pos1(0)_in_âŸ¨0,1âŸ©pos2)âˆ§(pos1(1)_in_âŸ¨Â¯2,0âŸ©pos2)      # horizontal-to-left_bar
          (pos1(0)_in_âŸ¨0,1âŸ©pos2)âˆ§(pos1(1)_in_âŸ¨Â¯1,1âŸ©pos2)      # horizontal-to-right_bar
          (pos1(0)_in_âŸ¨Â¯2,1âŸ©pos2)âˆ§(pos1(1)_in_âŸ¨Â¯2,Â¯2âŸ©pos2)    # vertical-to-left_bar
          (pos1(0)_in_âŸ¨Â¯2,1âŸ©pos2)âˆ§(pos1(1)_in_âŸ¨Â¯1,Â¯1âŸ©pos2)    # vertical-to-right_bar
        âŸ©
      ;
    2â€¿pos1 ğ•Š 0â€¿pos2 : 0â€¿pos2 ğ•Š 2â€¿pos1 ;
    2â€¿pos1 ğ•Š 1â€¿pos2 : 1â€¿pos2 ğ•Š 2â€¿pos1 ;
    3â€¿pos1 ğ•Š 3â€¿pos2 : (pos1(0)_in_âŸ¨Â¯3,3âŸ©pos2)âˆ§(pos1(1)_in_âŸ¨0,0âŸ©pos2) ;
    3â€¿pos1 ğ•Š 4â€¿pos2 : (pos1(0)_in_âŸ¨Â¯3,1âŸ©pos2)âˆ§(pos1(1)_in_âŸ¨0,1âŸ©pos2) ;
    3â€¿pos1 ğ•Š 0â€¿pos2 : 0â€¿pos2 ğ•Š 3â€¿pos1 ;
    3â€¿pos1 ğ•Š 1â€¿pos2 : 1â€¿pos2 ğ•Š 3â€¿pos1 ;
    3â€¿pos1 ğ•Š 2â€¿pos2 : 2â€¿pos2 ğ•Š 3â€¿pos1 ;
    4â€¿pos1 ğ•Š 4â€¿pos2 : (pos1(0)_in_âŸ¨Â¯1,1âŸ©pos2)âˆ§(pos1(1)_in_âŸ¨Â¯1,1âŸ©pos2) ;
    4â€¿pos1 ğ•Š 0â€¿pos2 : 0â€¿pos2 ğ•Š 4â€¿pos1 ;
    4â€¿pos1 ğ•Š 1â€¿pos2 : 1â€¿pos2 ğ•Š 4â€¿pos1 ;
    4â€¿pos1 ğ•Š 2â€¿pos2 : 2â€¿pos2 ğ•Š 4â€¿pos1 ;
    4â€¿pos1 ğ•Š 3â€¿pos2 : 3â€¿pos2 ğ•Š 4â€¿pos1 ;
    ğ•¨â€¿ğ•©!0
  }
  !1â€¿(2â€¿2) Clashes 2â€¿(4â€¿1)
  !2â€¿(4â€¿1) Clashes 1â€¿(2â€¿2)
  !2â€¿(3â€¿0) Clashes 1â€¿(2â€¿2)
  !Â¬2â€¿(4â€¿0) Clashes 1â€¿(2â€¿2)
  "# raw" util.Debug âŠ‘data
  "# wind" util.Debug jetPattern â† Â¯1+2Ã—'>'=âŠ‘data
  memory_length â† 25
  Force â† 0âŠ¸âˆ¾Â·jetPatternâŠ¸(âŠ‘Ëœ)(â‰ jetPattern)âŠ¸|
  Simulate â† {nth ğ•Š ground_levelâ€¿roundâ€¿record :
    rock â† shapesâ‰ âŠ¸|nth
    pos â† 1âŠ‘{fallingâ€¿pos:
      pos â†© pos+{Â¬âˆ¨Â´(rockâ‹ˆpos+ğ•©)âŠ¸ClashesÂ¨(âŸ¨âŸ¨âŸ©âŸ©âˆ¾(-memory_lengthâŒŠâ‰ )âŠ¸â†‘record)}âŠ¸Ã—Force round    # drifting by wind
      round 1âŠ¸+ â†©
      newpos â† âŸ¨Â¯1,0âŸ©+pos
      {
        Â¬âˆ¨Â´rockâ€¿newposâŠ¸ClashesÂ¨((-memory_lengthâŒŠâ‰ )âŠ¸â†‘record) ? 0<âŠ‘newpos ? 1â€¿newpos ;
        0â€¿pos
      }
    }â€¢_while_âŠ‘ 1â€¿âŸ¨4+ground_level,2âŸ©
    # "new ground_level" util.Debug âŠ‘pos
    # "new record" util.Debug recordâˆ¾<rockâ€¿pos
    âŸ¨ground_levelâŒˆ-Â¬(âŠ‘â‰¢rockâŠ‘shapes)+âŠ‘pos,round,recordâˆ¾<rockâ€¿posâŸ©
  }
  MetaSearch â† {@ :
    "â‰ jet" util.Debug ll â† â‰ jetPattern
    "# â‰ shapes" util.Debug ls â† â‰ shapes
    ground_levelâ€¿roundâ€¿record â† 0â€¿0â€¿âŸ¨âŸ©SimulateÂ´âŒ½â†•2Ã—ll
    "occurs" util.Debug Â¯40â†‘occur â† âŠ’><âˆ˜((<Â·â‹ˆâŸœ0Â·âŠ‘âŠ‘)-ËœâŠ¢)âˆ˜(1âŠ¸âŠ‘Â¨)Ë˜âŒŠâ€¿memory_lengthâ¥Šrecord
    "not enough length holds in record"!âˆ¨Â´2=occur
    "cycle length" util.Debug len â† memory_lengthÃ—+Â´1=occur
    "start at" util.Debug start â† 1+memory_lengthÃ—+Â´0=occur
    "cycle tower base height" util.Debug cycle_base_height â† âŠ‘1âŠ‘startâŠ‘record
    "cycle tower height" util.Debug cycle_height â† âŠ‘-â—‹(1âŠ¸âŠ‘âŠ‘âŸœrecord)Â´start+lenâ€¿0
    "unrational height"!(2-â—‹{âŠ‘âŠ‘(start+ğ•©Ã—len)âŠ‘record}1)=(3-â—‹{âŠ‘âŠ‘(start+ğ•©Ã—len)âŠ‘record}2)
    target â† 1000000000000-1
    util.Debug repeat â† lenâŒŠâˆ˜Ã·Ëœtarget-start
    offset â† len|target-start
    "rock_type" util.Debug rock_type â† âŠ‘(start+offset)âŠ‘record
    offset_height â† âŠ‘-â—‹(1âŠ¸âŠ‘âŠ‘âŸœrecord)Â´start+offsetâ€¿0
    -Â¬(â‰ rock_typeâŠ‘shapes)+offset_height+cycle_base_height+repeatÃ—cycle_height
  }
  {
    1=part ? âŠ‘0â€¿0â€¿âŸ¨âŸ©SimulateÂ´âŒ½â†•2022 ; MetaSearch@
  }
}
