Solve â‡ {envâ€¿part ğ•Š data :
  util â† â€¢Import "/util.bqn"âˆ¾Ëœ"." env.VarâŒ¾â‹ˆ "BQN_LIB"
  ymaxâ€¿xmax â† â‹ˆâ—‹(2âŠ¸+)Â´âŒˆË>âˆ¾segments â† âŒ½Â¨Â¨<Ë˜Â¨âˆ˜â€¿2âŠ¸â¥ŠÂ¨âŸ¨âŸ©âŠ¸â‰¢Â¨âŠ¸/util.ParseIntsÂ¨data
  {2=part ? xmax ymaxâŠ¸+ â†© ; @}
  map â† âŸ¨ymax,xmaxâŒˆ500+ymaxâŸ©â†‘0
  {seq â† â‹ˆâŒœÂ´((<âˆ˜â†•Â·(1âŠ¸+)-)+âŠ¢)Â´Ë˜âˆ¨Ë˜â‰>ğ•© â‹„ map 1Â¨âŒ¾(seqâŠ¸âŠ‘) â†© }Â¨âˆ˜<Ë˜âˆ˜(2âŠ¸â†•)Â¨segments
  {
    1=part ?
      map (shift â† Â¯2+ymax)âŠ¸â†“Ë˜ â†©
      DropSand â† {
        ymax=1+âŠ‘ğ•¨ ? map 1âŒ¾(ğ•¨âŠ¸âŠ‘) â†© â‹„ 0â€¿âŸ¨âŸ© ;
        âŸ¨âŸ©â‰¢p â† mapâŠ¸(Â¬âŠ‘Ëœ)Â¨âŠ¸/ğ•¨<âŠ¸+âŸ¨1â€¿0,1â€¿Â¯1,1â€¿1âŸ© ? 1â‹ˆğ•©âˆ¾1â†‘p ;
        map 1âŒ¾(ğ•¨âŠ¸âŠ‘) â†© â‹„ âŸ¨0,Â¯1â†“ğ•©âŸ©
      }Â´âˆ˜((âŠ‘Â¯1âŠ¸â†‘)âŠ¸â‹ˆ)âˆ˜(1âŠ¸âŠ‘)â€¢_while_âŠ‘1âŠ¸â‹ˆ
      Â¯1+âŠ‘{sandsâ€¿trace : âŸ¨1+sands,1âŠ‘DropSand traceâŸ©}â€¢_while_{âŸ¨âŸ©âŠ¸â‰¢1âŠ‘ğ•©}0â€¿âŸ¨âŸ¨0,500-shiftâŸ©âŸ©
    ;
      shift â† 500-floor â† 2+âŒˆÂ´âŠ‘Â¨âˆ¾segments
      map â†© shiftâŠ¸â†“Ë˜floorâ€¿(2Ã—xmax)â†‘map
      front â† (500-shift)=â†•1âŠ‘â‰¢map
      âŠ‘1â€¿front{ğ•¨ ğ•Š sandsâ€¿line : (sands++Â´)âŠ¸â‹ˆğ•¨Â¬âŠ¸âˆ§âŒˆË[Â«line,line,Â»line]}Â´âŒ½1â†“â¥Š<Ë˜map
  }
}
