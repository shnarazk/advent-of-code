#!/usr/bin/env cbqn
âŸ¨DataFile, ParseIntâŸ© â† â€¢Import "../lib.bqn"
moves â† (1âŠ¸â†‘â‹ˆ(ParseInt 2âŠ¸â†“))Â¨ â€¢FLines "data/2022/input-day09.txt" DataFile â€¢args
DirVec â† { 
  F âŸ¨"U", râŸ©: âŸ¨ 0, -1âŸ©; 
  F âŸ¨"D", râŸ©: âŸ¨ 0,  1âŸ©; 
  F âŸ¨"L", râŸ©: âŸ¨-1,  0âŸ©; 
  F âŸ¨"R", râŸ©: âŸ¨ 1,  0âŸ©; 
  "error" ! 1
}
UpdateTail â† {  
  âŸ¨dx, dyâŸ© â† ğ•¨ -Â¨ ğ•©
  ğ•© +Â¨ {
    1 < |dx Ã— dy ? âŸ¨dx Ã· |dx, dy Ã·| dyâŸ©;
    1 < |dx      ? âŸ¨dx Ã· |dx, 0âŸ©;
    1 < |dy      ? âŸ¨0, dy Ã·| dyâŸ©;
                   âŸ¨0, 0âŸ© 
  }
}
Update â† { 
  âŸ¨dir, 0âŸ© F state: state;
  âŸ¨dir, nâŸ© F âŸ¨head, tail, historyâŸ©:
    new_head â† head +Â¨ DirVec âŸ¨dir, nâŸ©
    new_tail â† new_head UpdateTail tail
    âŸ¨dx, dyâŸ© â† new_head -Â¨ tail
    new_history â† {
      âŸ¨new_tailâŸ© âŠ‘âˆ˜âˆŠ history ? history;
      âŸ¨new_tailâŸ© âˆ¾ history
    }
    # â€¢Show âŸ¨new_head, new_tail, n-1âŸ©
    âŸ¨dir, n-1âŸ© F âŸ¨new_head, new_tail, new_historyâŸ©
}
â€¢Show â‰ 2âŠ‘âŸ¨âŸ¨0,0âŸ©, âŸ¨0,0âŸ©, âŸ¨âŸ©âŸ© UpdateÂ´ âŒ½moves
Update2 â† { 
  âŸ¨dir, 0âŸ© F state: state;
  âŸ¨dir, nâŸ© F âŸ¨knots, historyâŸ©:
    Propagate â† {
      last F âŸ¨âŸ© : âŸ¨âŸ©;
      head â† âŠ‘ ğ•© 
      tail â† 1â†“ ğ•©
      new_head â†ğ•¨ UpdateTail head
      âŸ¨new_headâŸ©âˆ¾ new_head Propagate tail
    }
    head â† âŠ‘ knots
    tail â† 1â†“ knots
    new_head â† head +Â¨ DirVec âŸ¨dir, nâŸ©
    new_tail â† new_head Propagate tail
    true_tail â† âŠ‘âŒ½new_tail
    new_history â† {
      âŸ¨true_tailâŸ© âŠ‘âˆ˜âˆŠ history ? history;
      âŸ¨true_tailâŸ© âˆ¾ history
    }
    âŸ¨dir, n-1âŸ© F âŸ¨âŸ¨new_headâŸ©âˆ¾new_tail, new_historyâŸ©
}
â€¢Show â‰ 1âŠ‘âŸ¨âŸ¨0, 0âŸ©Ë™Â¨â†•10, âŸ¨âŸ©âŸ© Update2Â´ âŒ½moves
