#!/usr/bin/env cbqn
âŸ¨DataFile, ParseIntâŸ© â† â€¢Import "../lib.bqn"
moves â† (1âŠ¸â†‘â‹ˆ(ParseInt 2âŠ¸â†“))Â¨ â€¢FLines "data/2022/input-day09.txt" DataFile â€¢args
DirVec â† {
  F âŸ¨"U", râŸ©: âŸ¨ 0, -1âŸ©;
  F âŸ¨"D", râŸ©: âŸ¨ 0,  1âŸ©;
  F âŸ¨"L", râŸ©: âŸ¨-1,  0âŸ©;
  F âŸ¨"R", râŸ©: âŸ¨ 1,  0âŸ©;
  "error" ! 1
}
UpdateTail â† {
  âŸ¨dx, dyâŸ© â† ğ•¨ -Â¨ ğ•©
  ğ•© +Â¨ {
    1 < |dx Ã— dy ? âŸ¨dx Ã· |dx, dy Ã·| dyâŸ©;
    1 < |dx      ? âŸ¨dx Ã· |dx, 0âŸ©;
    1 < |dy      ? âŸ¨0, dy Ã·| dyâŸ©;
                   âŸ¨0, 0âŸ©
  }
}
Update â† {
  âŸ¨dir, 0âŸ© F state: state;
  âŸ¨dir, nâŸ© F âŸ¨head, tail, historyâŸ©:
    h â† head +Â¨ DirVec ğ•¨
    t â† h UpdateTail tail
    âŸ¨dx, dyâŸ© â† h -Â¨ tail
    âŸ¨dir, n-1âŸ© F âŸ¨h, t, { âŸ¨tâŸ© âŠ‘âˆ˜âˆŠ history ? history; âŸ¨tâŸ© âˆ¾ history }âŸ©
}
â€¢Show â‰ 2âŠ‘âŸ¨âŸ¨0,0âŸ©, âŸ¨0,0âŸ©, âŸ¨âŸ©âŸ© UpdateÂ´ âŒ½moves
Update2 â† {
  âŸ¨dir, 0âŸ© F state: state;
  âŸ¨dir, nâŸ© F âŸ¨knots, historyâŸ©:
    Propagate â† {
      last F âŸ¨âŸ© : âŸ¨âŸ©;
      âŸ¨head, tailâŸ© â† (âŠ‘â‹ˆ1âŠ¸â†“) ğ•©
      h â† ğ•¨ UpdateTail head
      âŸ¨hâŸ©âˆ¾ h Propagate tail
    }
    âŸ¨head, tailâŸ© â† (âŠ‘â‹ˆ1âŠ¸â†“) knots
    h â† head +Â¨ DirVec ğ•¨
    t â† h Propagate tail
    âŸ¨dir, n-1âŸ© F âŸ¨âŸ¨hâŸ©âˆ¾t, { âŸ¨ğ•©âŸ© âŠ‘âˆ˜âˆŠ history ? history; âŸ¨ğ•©âŸ© âˆ¾ history } âŠ‘âŒ½tâŸ©
}
â€¢Show â‰ 1âŠ‘âŸ¨âŸ¨0, 0âŸ©Ë™Â¨â†•10, âŸ¨âŸ©âŸ© Update2Â´ âŒ½moves
