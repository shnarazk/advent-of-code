lib â† â€¢Import "../lib.bqn"

Mdist â† { âŸ¨sx,syâŸ© ğ•Š âŸ¨bx,byâŸ©: (sx-bx)+â—‹|(sy-by) }
Band â† { target_y ğ•Š âŸ¨sx,sy,dâŸ©: dx â† d-|target_y-syâ‹„ { 0â‰¤dx ? âŸ¨sx-dx,sx+dxâŸ©; âŸ¨âŸ© } }
CrossPoint â† { âŸ¨ax,ay,bx,byâŸ© ğ•Š âŸ¨sx,sy,tx,tyâŸ©:
  âŸ¨f,gâŸ© â† âŸ¨Ã—by-ay,Ã—ty-syâŸ©
  {
    f=g ? âŸ¨âŸ©;
      x â† ((sy + fÃ—ax)-(ay+gÃ—sx))Ã·(f - g)
      y â† ay + x - ax
      (axâ‰¤x)âˆ§(xâ‰¤bx)âˆ§(ayâ‰¤y)âˆ§(yâ‰¤bx)?âŸ¨x,yâŸ©;âŸ¨âŸ©
  }
}
CP â† { âŸ¨ax,ay,bx,byâŸ© ğ•Š âŸ¨sx,sy,tx,tyâŸ©:
  { ax<bx ? âŸ¨ax,ay,bx,byâŸ©; âŸ¨bx,by,ax,ayâŸ©} CrossPoint { sx<tx ? âŸ¨sx,sy,tx,tyâŸ©; âŸ¨tx,ty,sx,syâŸ©}
}
Intersections â† { âŸ¨ax,ay,ad1âŸ© ğ•Š âŸ¨bx,by,bd1âŸ©:
  âŸ¨ad,bdâŸ© â† âŸ¨ad1+1,bd1+1âŸ©
  âŸ¨âŸ©âŠ¸â‰¢Â¨âŠ¸/ âŸ¨
    âŸ¨ax,ay-ad,ax+ad,ayâŸ©CPâŸ¨bx-bd,by,bx,by-bdâŸ©,
    âŸ¨ax,ay-ad,ax+ad,ayâŸ©CPâŸ¨bx+bd,by,bx,by+bdâŸ©,
    âŸ¨ax,ay+ad,ax-ad,ayâŸ©CPâŸ¨bx-bd,by,bx,by-bdâŸ©,
    âŸ¨ax,ay+ad,ax-ad,ayâŸ©CPâŸ¨bx+bd,by,bx,by+bdâŸ©,
    âŸ¨ax,ay+ad,ax+ad,ayâŸ©CPâŸ¨bx-bd,by,bx,by+bdâŸ©,
    âŸ¨ax,ay+ad,ax+ad,ayâŸ©CPâŸ¨bx+bd,by,bx,by-bdâŸ©,
    âŸ¨ax,ay-ad,ax-ad,ayâŸ©CPâŸ¨bx-bd,by,bx,by+bdâŸ©,
    âŸ¨ax,ay-ad,ax-ad,ayâŸ©CPâŸ¨bx+bd,by,bx,by-bdâŸ©,
 âŸ©
}

Solve â‡ { part ğ•Š lines:
  data â† (lib.ParseInts{âˆŠâŸœ("-,:"âˆ¾'0'+Â¨â†•10)}âŠ¸/)Â¨ lines
  sensors â† {âŸ¨sx,sy,bx,byâŸ© â† ğ•© â‹„ âŸ¨sx,sy, âŸ¨sx,syâŸ© Mdist âŸ¨bx,byâŸ©âŸ©}Â¨ data
  {
    1=part ? 
      p1 â† 2000000
      b â† âˆ¨(0<â‰ )Â¨âŠ¸/ p1 BandÂ¨ sensors
      on_mark â† â‰ â·{âŸ¨2âŠ‘ğ•©,3âŠ‘ğ•©âŸ©}Â¨((p1âŠ¸=)âˆ˜(3âŠ¸âŠ‘))Â¨âŠ¸/ data
      F â† { âŸ¨s,eâŸ© ğ•Š âŸ¨total,start,endâŸ© : {s â‰¤ end ? âŸ¨total,start,eâŒˆendâŸ©; âŸ¨total+end-start+1,s,eâŸ©} }
      on_mark + {0âŠ‘ğ•©+2âŠ‘ğ•©-1âŠ‘ğ•©+1} âŸ¨0,0âŠ‘Â¯1âŠ‘b,1âŠ‘Â¯1âŠ‘bâŸ©FÂ´b
    ;
      p2 â† 4000000
      cands â† âˆ§â·âˆ¾â¥Šâˆ˜â€¿1â¥Š(IntersectionsâŒœËœ)sensors
      # â€¢Show âˆ˜â€¿1â¥Š(2727057âŠ¸=âŠ‘)Â¨âŠ¸/cands
      Sat â† {
        c ğ•Š 0: {(0â‰¤0âŠ‘c)âˆ§(0âŠ‘câ‰¤p2)âˆ§(0â‰¤1âŠ‘c)âˆ§(1âŠ‘câ‰¤p2) ? âˆ§Â´{2âŠ‘ğ•©<c Mdist âŸ¨0âŠ‘ğ•©,1âŠ‘ğ•©âŸ©}Â¨ sensors ? (1âŠ‘c)+(0âŠ‘c)Ã—p2; 0};
        c ğ•Š n: n
      }
      0 SatÂ´ cands
  }
}