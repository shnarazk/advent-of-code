#!/usr/bin/env cbqn
lib â† â€¢Import "../lib.bqn"
lines â† â€¢Flines "data/2022/input-day15.txt" lib.DataFile âŸ¨âŸ© # â€¢args
data â† (lib.ParseInts{âˆŠâŸœ("-,:"âˆ¾'0'+Â¨â†•10)}âŠ¸/)Â¨ lines
Mdist â† { âŸ¨sx,syâŸ© ğ•Š âŸ¨bx,byâŸ©: (sx-bx)+â—‹|(sy-by) }
sensors â† {âŸ¨sx,sy,bx,byâŸ© â† ğ•© â‹„ âŸ¨sx,sy, âŸ¨sx,syâŸ© Mdist âŸ¨bx,byâŸ©âŸ©}Â¨ data
Band â† { target_y ğ•Š âŸ¨sx,sy,dâŸ©: dx â† d-|target_y-syâ‹„ { 0 â‰¤ dx ? âŸ¨sx-dx,sx+dxâŸ©; âŸ¨âŸ© } }
p1 â† 2000000
b â† âˆ¨(0<â‰ )Â¨âŠ¸/ p1 BandÂ¨ sensors
# â€¢Show âˆ˜â€¿1â¥Š b
on_mark â† â‰ â·{âŸ¨2âŠ‘ğ•©,3âŠ‘ğ•©âŸ©}Â¨((p1âŠ¸=)âˆ˜(3âŠ¸âŠ‘))Â¨âŠ¸/ data
F â† { âŸ¨s, eâŸ© ğ•Š âŸ¨total, start, endâŸ© : {s â‰¤ end ? âŸ¨total,start,eâŒˆendâŸ©; âŸ¨total+end-start+1,s,eâŸ©} }
â€¢Show on_mark + {0âŠ‘ğ•©+2âŠ‘ğ•©-1âŠ‘ğ•©+1} âŸ¨0,0âŠ‘Â¯1âŠ‘b,1âŠ‘Â¯1âŠ‘bâŸ©FÂ´b
p2 â† 4000000
Intersections â† {
  âŸ¨ax,ay,ad1âŸ© â† ğ•¨
  âŸ¨bx,by,bd1âŸ© â† ğ•©
  ad â† ad1 + 1
  bd â† bd1 + 1
  âŸ¨_pd,px,pyâŸ© â† âŠ‘âˆ§{âŸ¨âŸ¨1âŠ‘ğ•©,1âŠ‘ğ•©âŸ© Mdist âŸ¨bx,byâŸ©,0âŠ‘ğ•©,1âŠ‘ğ•©âŸ©}Â¨âŸ¨âŸ¨ax,ay+adâŸ©,âŸ¨ax,ay-adâŸ©,âŸ¨ax+ad,ayâŸ©,âŸ¨ax-ad,ayâŸ©âŸ©
  âŸ¨_qd,qx,qyâŸ© â† âŠ‘âˆ§{âŸ¨âŸ¨0âŠ‘ğ•©,1âŠ‘ğ•©âŸ© Mdist âŸ¨ax,ayâŸ©,0âŠ‘ğ•©,1âŠ‘ğ•©âŸ©}Â¨âŸ¨âŸ¨bx,by+bdâŸ©,âŸ¨bx,by-bdâŸ©,âŸ¨bx+bd,byâŸ©,âŸ¨bx-bd,byâŸ©âŸ©
  {
    (pxâ‰¡qx)âˆ§(pyâ‰¡qy) ? âŸ¨âŸ©;
      âŸ¨x1,y1âŸ© â† âŸ¨px+(-py)+qx+qy, (-px)+(2Ã—py)+(2Ã—qx)+qyâŸ©
      âŸ¨x2,y2âŸ© â† âŸ¨px+py+qx+(-qy), (Â¯3Ã—px)+(Â¯3Ã—py)+(-qx)+qyâŸ©
      âŸ¨âŸ©âŠ¸â‰¢Â¨âŠ¸/âŸ¨{(2|x1)âˆ¨(2|y1) ? âŸ¨âŸ©; âŸ¨2Ã·Ëœx1,2Ã·Ëœy1âŸ©},{(2|x2)âˆ¨(2|y2) ? âŸ¨âŸ©; âŸ¨2Ã·Ëœx2,2Ã·Ëœy2âŸ©}âŸ©
  }
}
# â€¢Show âˆ˜â€¿1â¥Šâˆ§â·â¥ŠIntersectionsâŒœËœ sensors
# â€¢Show â¥ŠIntersectionsâŒœËœ 3â†‘sensors
# â€¢Show cands â† âˆ˜â€¿1â¥Šâˆ§â·âˆ¾â¥Šâˆ˜â€¿1â¥Š(IntersectionsâŒœËœ) sensors
cands â† âˆ§â·âˆ¾â¥Šâˆ˜â€¿1â¥Š(IntersectionsâŒœËœ) sensors
â€¢Show âˆ˜â€¿1â¥Š(2727057âŠ¸=âŠ‘)Â¨âŠ¸/cands
CheckAround â† {
  âŸ¨sx,sy,dâŸ© ğ•Š 0:
    ss â† {(âŸ¨sx,syâŸ© Mdist âŸ¨0âŠ‘ğ•©,1âŠ‘ğ•©âŸ©)â‰¤1+2âŠ‘ğ•©+d}Â¨âŠ¸/sensors
    Sat â† { ğ•Š c: (0â‰¤0âŠ‘c)âˆ§(0âŠ‘câ‰¤p2)âˆ§(0â‰¤1âŠ‘c)âˆ§(1âŠ‘câ‰¤p2) ? âˆ§Â´{2âŠ‘ğ•©<c Mdist âŸ¨0âŠ‘ğ•©,1âŠ‘ğ•©âŸ©}Â¨ ss; 0 }
    p â† d+1
    l â† â†•p
    k â† (SatÂ¨âŠ¸/{âŸ¨sx+ğ•©,(sy-p)+ğ•©âŸ©}Â¨l) âˆ¾(SatÂ¨âŠ¸/{âŸ¨(sx+p)-ğ•©,sy+ğ•©âŸ©}Â¨l) âˆ¾(SatÂ¨âŠ¸/{âŸ¨sx-ğ•©,(sy+p)-ğ•©âŸ©}Â¨l) âˆ¾(SatÂ¨âŠ¸/{âŸ¨(sx-p)+ğ•©,sy-ğ•©âŸ©}Â¨l)
    { kâ‰¢âŸ¨âŸ© ? â€¢Show k;@ }
    { kâ‰¡âŸ¨âŸ© ? 0; {(1âŠ‘ğ•©)+(0âŠ‘ğ•©)Ã—p2}âŠ‘k };
  ğ•¨ ğ•Š n: n  
}
â€¢Show 0 CheckAroundÂ´ sensors
Sat â† { 
  c ğ•Š 0: {(0â‰¤0âŠ‘c)âˆ§(0âŠ‘câ‰¤p2)âˆ§(0â‰¤1âŠ‘c)âˆ§(1âŠ‘câ‰¤p2) ? âˆ§Â´{2âŠ‘ğ•©<c Mdist âŸ¨0âŠ‘ğ•©,1âŠ‘ğ•©âŸ©}Â¨ sensors; 0};
  c ğ•Š n: n
}
â€¢Show 0 SatÂ´ cands
