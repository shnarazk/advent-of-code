#!/usr/bin/env cbqn
âŸ¨color,DataFile,ParseInts,StartsWithâŸ© â† â€¢Import "../lib.bqn"
session â† (âŸ¨âŸ©âŠ¸â‰¢)Â¨âŠ¸/{(âŸ¨âŸ©âŠ¸â‰¢)Â¨âŠ¸/ " "((âŠ¢-ËœÂ¬Ã—Â·+`Â»âŠ¸<)âˆ˜âˆŠËœâŠ”âŠ¢) ğ•©}Â¨"$"((âŠ¢-ËœÂ¬Ã—Â·+`Â»âŠ¸<)âˆ˜âˆŠËœâŠ”âŠ¢)âˆ¾(" "âŠ¸âˆ¾Ëœ)Â¨âˆ˜â€¢FLines "data/2022/input-day07.txt" DataFile â€¢args 
dirs â† âŸ¨âŸ©
Traverse â† { interaction ğ•Š pwd:
  cmd â† âŠ‘interaction
  {
    "cd"â‰¡cmd ?
      {
        âŸ¨"cd"âŸ©â‰¡interaction      ? pwd â†© âŸ¨"/"âŸ©; 
        âŸ¨"cd",".."âŸ©â‰¡interaction ? pwd  (Â¯1+â‰ )âŠ¸â†‘â†©; 
                                  pwd (<1âŠ‘interaction)âŠ¸(âˆ¾Ëœ)â†©
      }
      { 0=â‰ pwd ? pwd â†© âŸ¨"/"âŸ©;@ }
      ; 
    "ls"â‰¡cmd ?
      total â† 0
      # â€¢Out color.green color.Out (âˆ¾pwd)âˆ¾(": ")âˆ¾â€¢Fmt interaction
      {
        "dir" D subdir:
          # â€¢Out color.green color.Out "subdir:"âˆ¾subdir
          âŸ¨âŸ©;
        size F fname: 
          total (â€¢BQN size)âŠ¸+â†© 
          # â€¢Out color.green color.Out "file:"âˆ¾fname
          âŸ¨âŸ©;
        w E x:
          color.red color.Fmt "strange ls output format"
          âŸ¨âŸ©
      }Â´Ë˜(2âŠ¸|)Â¨âˆ˜â†•âˆ˜â‰ âŠ¸/2â†•interaction
      dirs âŸ¨âŸ¨âˆ¾pwd, totalâŸ©âŸ©âŠ¸âˆ¾â†© 
      ;  
    â€¢Out color.red color.Fmt "âŸ¨â‰¢interaction,â‰¢cmdâŸ©" 
  }
  pwd
}
âŸ¨âŸ© TraverseÂ´ âŒ½session
ComponentsOf â† {(ğ•©Ë™(StartsWithËœ)âŠ‘)Â¨âŠ¸/dirs}
eachDir â† (âŠ‘â‹ˆ(+Â´âˆ˜((1âŠ¸âŠ‘)Â¨)âˆ˜ComponentsOfâŠ‘))Â¨ dirs
â€¢Show +Â´(1âŠ¸âŠ‘)Â¨(100000â‰¥1âŠ¸âŠ‘)Â¨âŠ¸/ eachDir
dirSizes â† {ğ•Š aâ€¿b: bâ€¿a}Â¨ eachDir
â€¢Out color.blue color.Fmt "used"â‹ˆ1âŠ¸âŠ‘âŠ‘("/"âŠ¸â‰¡âŠ‘)Â¨âŠ¸/eachDir
â€¢Out color.blue color.Fmt "free"â‹ˆfree â† 70000000-1âŠ¸âŠ‘âŠ‘("/"âŠ¸â‰¡âŠ‘)Â¨âŠ¸/eachDir
â€¢Out color.blue color.Fmt "to be freed"â‹ˆrequired â† 30000000 - free
â€¢Out color.blue color.Fmt âŠ‘âˆ§(requiredâŠ¸<âŠ‘)Â¨âŠ¸/dirSizes
â€¢Show âŠ‘âŠ‘âˆ§(requiredâŠ¸<âŠ‘)Â¨âŠ¸/dirSizes
