#!/usr/bin/env cbqn
⟨DataFile⟩ ← •Import "../lib.bqn"
map ← (⋈˜∘√∘≠)⊸⥊∾'0'-˜˜˜ •FLines "data/2022/input-day08.txt" DataFile •args
Sight ← {𝕊 ⟨w,x⟩: w ((x⊸(⋈˜)¨¨⊣)∾(w⊸⋈¨¨⊢))○{𝕊 p:{p>𝕩?¯1+p-𝕩;𝕩}¨¨p((⊢-˜+`×¬)∘=⊔⊢)↕1⊑≢map} x}
_alldirs_ ← {F _𝕣_ G 𝕩: {w H dirs: 4=≠dirs ? G´{w F 𝕩}¨dirs; 0}⟜Sight 𝕩}
•Show +´¬¨({w F xs: ∨´{w≤○(map˙⊸(⊑˜))𝕩}¨xs}_alldirs_ ∧)¨⥊(⋈⌜○↕)´≢map
•Show ⌈´({w F xs: (≠xs)⌊1+⊑⟨1⟩⊐˜{w≤○(map˙⊸(⊑˜))𝕩}¨xs}_alldirs_ ×)¨⥊(⋈⌜○↕)´≢map
