lib â† â€¢Import "../lib.bqn"

Solve â‡ { part Solve data:
  Facets â† {xâ€¿yâ€¿z :
    [âŸ¨x-0.5,y,zâŸ©,âŸ¨x+0.5,y,zâŸ©,âŸ¨x,y-0.5,zâŸ©,âŸ¨x,y+0.5,zâŸ©,âŸ¨x,y,z-0.5âŸ©,âŸ¨x,y,z+0.5âŸ©]
  }
  "â‰ all" lib.Debugâ‰  all â† â¥Š<Ë˜âˆ¾FacetsÂ¨lib.ParseIntsÂ¨data
  { 1=part ? (â‰ -(2âŠ¸Ã—âˆ˜(-â—‹â‰ âŸœâ·)))all ;
    2=part ?
      # {
      #   "all facets" lib.Debug a â† âŸ¨âŸ¨0,0âŸ©,âŸ¨1,0âŸ©,âŸ¨0,0âŸ©,âŸ¨2,0âŸ©,âŸ¨2,0âŸ©âŸ©
      #   "a's non-firsts mask" lib.Debug m â† Â¬âˆŠa
      #   "a's non-firsts" lib.Debug c â† m/a
      #   "remains" lib.Debug (Â¬aâˆŠc)/a
      #   !0
      # }
      dup â† (Â¬âˆŠ)âŠ¸/all
      # Change to a directed space
      Lift â† {ğ•Š xâ€¿yâ€¿z :
        {
          xâ‰ âŒŠx ? âŸ¨x+0.5,y,z,3âŸ©â€¿âŸ¨x-0.5,y,z,2âŸ© ;
          yâ‰ âŒŠy ? âŸ¨x,y+0.5,z,5âŸ©â€¿âŸ¨x,y-0.5,z,4âŸ© ;
          zâ‰ âŒŠz ? âŸ¨x,y,z+0.5,7âŸ©â€¿âŸ¨x,y,z-0.5,6âŸ© ;
          !0
        }
      }
      DirectedFacets â† âˆ¾Â¨âŸœ(2+â†•6)<
      dirÂ¯all â† âˆ¾DirectedFacetsÂ¨ lib.ParseIntsÂ¨data
      mask â† dirÂ¯allâˆŠâˆ¾LiftÂ¨ dup
      "â‰ surface" lib.Debug â‰ surface â† (Â¬mask)/dirÂ¯all
      Propagate â† {
        ğ•Š ğ•© : surface ğ•Š ğ•©;
        set ğ•Š xâ€¿yâ€¿zâ€¿s:
        # {1â€¿Â¯1â€¿0â‰¡b-â—‹(3âŠ¸â†‘)a ? lib.Debug aâ€¿b; @}
        cands â† {
          ğ•Š 2 : [
            âŸ¨âŸ¨x+1,y+1,z  ,5âŸ©,âŸ¨x  ,y+1,z  ,2âŸ©,âŸ¨x  ,y  ,z  ,4âŸ©âŸ©
            âŸ¨âŸ¨x+1,y-1,z  ,4âŸ©,âŸ¨x  ,y-1,z  ,2âŸ©,âŸ¨x  ,y  ,z  ,5âŸ©âŸ©
            âŸ¨âŸ¨x+1,y  ,z+1,7âŸ©,âŸ¨x  ,y  ,z+1,2âŸ©,âŸ¨x  ,y  ,z  ,6âŸ©âŸ©
            âŸ¨âŸ¨x+1,y  ,z-1,6âŸ©,âŸ¨x  ,y  ,z-1,2âŸ©,âŸ¨x  ,y  ,z  ,7âŸ©âŸ©
          ] ;
          ğ•Š 3 : [
            âŸ¨âŸ¨x-1,y+1,z  ,5âŸ©,âŸ¨x  ,y+1,z  ,3âŸ©,âŸ¨x  ,y  ,z  ,4âŸ©âŸ©
            âŸ¨âŸ¨x-1,y-1,z  ,4âŸ©,âŸ¨x  ,y-1,z  ,3âŸ©,âŸ¨x  ,y  ,z  ,5âŸ©âŸ©
            âŸ¨âŸ¨x-1,y  ,z+1,7âŸ©,âŸ¨x  ,y  ,z+1,3âŸ©,âŸ¨x  ,y  ,z  ,6âŸ©âŸ©
            âŸ¨âŸ¨x-1,y  ,z-1,6âŸ©,âŸ¨x  ,y  ,z-1,3âŸ©,âŸ¨x  ,y  ,z  ,7âŸ©âŸ©
          ] ;
          ğ•Š 4 : [
            âŸ¨âŸ¨x+1,y+1,z  ,3âŸ©,âŸ¨x+1,y  ,z  ,4âŸ©,âŸ¨x  ,y  ,z  ,2âŸ©âŸ©
            âŸ¨âŸ¨x-1,y+1,z  ,2âŸ©,âŸ¨x-1,y  ,z  ,4âŸ©,âŸ¨x  ,y  ,z  ,3âŸ©âŸ©
            âŸ¨âŸ¨x  ,y+1,z+1,7âŸ©,âŸ¨x  ,y  ,z+1,4âŸ©,âŸ¨x  ,y  ,z  ,6âŸ©âŸ©
            âŸ¨âŸ¨x  ,y+1,z-1,6âŸ©,âŸ¨x  ,y  ,z-1,4âŸ©,âŸ¨x  ,y  ,z  ,7âŸ©âŸ©
          ] ;
          ğ•Š 5 : [
            âŸ¨âŸ¨x+1,y-1,z  ,3âŸ©,âŸ¨x+1,y  ,z  ,5âŸ©,âŸ¨x  ,y  ,z  ,2âŸ©âŸ©
            âŸ¨âŸ¨x-1,y-1,z  ,2âŸ©,âŸ¨x-1,y  ,z  ,5âŸ©,âŸ¨x  ,y  ,z  ,3âŸ©âŸ©
            âŸ¨âŸ¨x  ,y-1,z+1,7âŸ©,âŸ¨x  ,y  ,z+1,5âŸ©,âŸ¨x  ,y  ,z  ,6âŸ©âŸ©
            âŸ¨âŸ¨x  ,y-1,z-1,6âŸ©,âŸ¨x  ,y  ,z-1,5âŸ©,âŸ¨x  ,y  ,z  ,7âŸ©âŸ©
          ] ;
          ğ•Š 6 : [
            âŸ¨âŸ¨x+1,y  ,z+1,3âŸ©,âŸ¨x+1,y  ,z  ,6âŸ©,âŸ¨x  ,y  ,z  ,2âŸ©âŸ©
            âŸ¨âŸ¨x-1,y  ,z+1,2âŸ©,âŸ¨x-1,y  ,z  ,6âŸ©,âŸ¨x  ,y  ,z  ,3âŸ©âŸ©
            âŸ¨âŸ¨x  ,y+1,z+1,5âŸ©,âŸ¨x  ,y+1,z  ,6âŸ©,âŸ¨x  ,y  ,z  ,4âŸ©âŸ©
            âŸ¨âŸ¨x  ,y-1,z+1,4âŸ©,âŸ¨x  ,y-1,z  ,6âŸ©,âŸ¨x  ,y  ,z  ,5âŸ©âŸ©
          ] ;
          ğ•Š 7 : [
            âŸ¨âŸ¨x+1,y  ,z-1,3âŸ©,âŸ¨x+1,y  ,z  ,7âŸ©,âŸ¨x  ,y  ,z  ,2âŸ©âŸ©
            âŸ¨âŸ¨x-1,y  ,z-1,2âŸ©,âŸ¨x-1,y  ,z  ,7âŸ©,âŸ¨x  ,y  ,z  ,3âŸ©âŸ©
            âŸ¨âŸ¨x  ,y+1,z-1,5âŸ©,âŸ¨x  ,y+1,z  ,7âŸ©,âŸ¨x  ,y  ,z  ,4âŸ©âŸ©
            âŸ¨âŸ¨x  ,y-1,z-1,4âŸ©,âŸ¨x  ,y-1,z  ,7âŸ©,âŸ¨x  ,y  ,z  ,5âŸ©âŸ©
          ] ;
          ğ•Š n : !0
        } s
        # "set(ğ•©)" lib.Debug set
        # "tmplts" lib.Debug cands
        # "âŠ‘tmpls" lib.Debug âŠcands
        # "(âŠcands)âˆŠset" lib.Debug (âŠcands)âˆŠset
        # "4 hits" lib.Debug (âˆŠâŸœset)ËœË˜cands
        # "output" lib.Debug âˆ¾(<(âˆŠâŸœset)âŠ¸/)Ë˜cands
        # â¥Š((0âŠ¸<â‰ )âŠ¸â†‘(âˆŠâŸœset)âŠ¸/)Ë˜cands
        âˆ¾(<(âˆŠâŸœset)âŠ¸/)Ë˜cands
      }
      {
        start â† âŸ¨0,0,0,2âŸ©
        set â† â¥Š<Ë˜[
          âŸ¨0,0,0,4âŸ©
          âŸ¨0,0,0,5âŸ©
          âŸ¨0,0,0,6âŸ©
          âŸ¨0,0,0,7âŸ©
          âŸ¨0,0,1,2âŸ©
          âŸ¨0,0,1,7âŸ©
          âŸ¨0,1,0,2âŸ©
        ]
        "set" lib.Debug set
        "test1" lib.Debug set Propagate start
        # !0
      }
      "outers" lib.Debug âŸ¨âŸ©{
        checked Rec âŸ¨âŸ©  : â‰ â·checked;
        checked Rec new :
          np â† â‰ prop â† â·âˆ¾PropagateÂ¨new
          # drop surfaces that are stored checked already
          prop â†© â·(Â¬âˆŠâŸœcheckedËœ)âŠ¸/prop
          "â‰ prop" lib.Debug npâ€¿(â‰ prop)
          (â·checkedâˆ¾new) Rec prop

        #   "â‰ prop" lib.Debug â‰ prop â† â·âˆ¾PropagateâŸœremainËœÂ¨new
        #   # "new furfaces" lib.Debug prop â† â· âˆ¾remain PropagateÂ¨ new
        #   # "5â†‘r" lib.Debug r â† (âŠ£remainâˆŠâ—‹(<Â¨)prop)/remain
        #   "â‰ r" lib.Debug â‰ r â† (Â¬remainâˆŠprop)/remain
        #   "â‰ remain â†’ â‰ new + â‰ remain" lib.DebugâŸ¨â‰ remain,â‰ prop,â‰ râŸ©
        #   ! (â‰ remain) = r +â—‹â‰  prop
        #   (checked+â‰ new) Rec râ€¿prop;
        # checked Rec remain     : checked
      } 1â†‘âˆ§surface
    ;
      âŸ¨1 Solve data, 2 Solve dataâŸ©
  }
}
