#!/usr/bin/env cbqn
âŸ¨DataFile,ParseInts,Swap,WhileâŸ© â† â€¢Import "../lib.bqn"
âŸ¨_to_heapâŸ© â† â€¢Import "../heap.bqn"
data â† (Swap ParseIntsâˆ¾{((<1âŠ¸âŠ‘)âˆ¾9âŠ¸â†“)(','âŠ¸â‰ Â¨âŠ¸/)Â¨" "âŠ¸((âŠ¢-ËœÂ¬Ã—Â·+`Â»âŠ¸<)âˆ˜âˆŠËœâŠ”âŠ¢)ğ•©})Â¨ â€¢Flines "data/2022/input-day16-0.txt" DataFile âŸ¨âŸ© # â€¢args
nodes â† âˆ§â·âŠ‘Â¨data
! 0=âŠ‘nodesâŠ<"AA" # Product â† +Ëâˆ˜Ã—â‰1â€¿âˆ
label_pairs â† âˆ§âˆ¾(âŠ(âˆ¾â—‹<)Â¨(2âŠ¸â†“))Â¨data
pairs â† {ğ•Š âŸ¨a,bâŸ©: âŸ¨âŠ‘nodesâŠ’<a,âŠ‘nodesâŠ’<bâŸ©}Â¨label_pairs
dist â† (âŒŠËâˆ˜+â‰1â€¿âˆ)âŸ(â‰ nodes)Ëœ {ğ•¨â‰¡ğ•© ? 0; âŠ‘pairsâˆŠËœâ‹ˆâŸ¨ğ•¨,ğ•©âŸ© ? 1; âˆ}âŒœËœâ†•â‰ nodes
To_visit â† (<â—‹âŠ‘)_to_heap
to_visit.Push initial_state â† <âŸ¨0, 0, 0, (0âŠ¸=)Â¨â†•â‰ nodesâŸ©
visited â† âŸ¨initial_stateâŸ©
Expand â† {limit F âŸ¨time, flow, pos, statesâŸ©:
  {F âŸ¨next_pos,costâŸ©:
    {(next_pos=pos)âˆ¨(next_posâŠ‘states)âˆ¨(limit<time+cost) ? @;
      new_time â† 1+time+cost
      gain â† (limit-new_time)Ã—1âŠ‘next_posâŠ‘data
      new â† <âŸ¨new_time,flow+gain,next_pos,1Ë™âŒ¾(next_posâŠ¸âŠ‘)statesâŸ©
      {visited(âŠ‘âˆŠ)ËœâŸ¨newâŸ© ? @; visited (âŸ¨newâŸ©âŠ¸âˆ¾)â†©â‹„  to_visit.Push new}
    }
  }Â¨ ((â†•â‰ )â‹ˆÂ¨âŠ¢) posâŠdist
}
Serch â† {F limit: 
  cands â† âŸ¨0âŸ©
  While {ğ•¤â‹„ Â¬to_visit.Empty @}â€¿{ğ•¤â‹„ state â† to_visit.Pop @â‹„ cands â†© â·(1âŠ‘state)âˆ¾candsâ‹„ limit Expand state}
  cands
}
â€¢Show âŠ‘âˆ¨ Serch 8
