#!/usr/bin/env cbqn
âŸ¨DataFile,ParseInts,SwapâŸ© â† â€¢Import "../lib.bqn"
âŸ¨_to_heapâŸ© â† â€¢Import "../heap.bqn"
data â† (Swap ParseIntsâˆ¾{((<1âŠ¸âŠ‘)âˆ¾9âŠ¸â†“)(','âŠ¸â‰ Â¨âŠ¸/)Â¨" "âŠ¸((âŠ¢-ËœÂ¬Ã—Â·+`Â»âŠ¸<)âˆ˜âˆŠËœâŠ”âŠ¢)ğ•©})Â¨ â€¢Flines "data/2022/input-day16.txt" DataFile âŸ¨âŸ© # â€¢args
nodes â† âˆ§â·âŠ‘Â¨data
! 0=âŠ‘nodesâŠ<"AA" # Product â† +Ëâˆ˜Ã—â‰1â€¿âˆ
label_pairs â† âˆ§âˆ¾(âŠ(âˆ¾â—‹<)Â¨(2âŠ¸â†“))Â¨data
pairs â† {ğ•Š âŸ¨a,bâŸ©: âŸ¨âŠ‘nodesâŠ’<a,âŠ‘nodesâŠ’<bâŸ©}Â¨label_pairs
# dist â† { ğ•¨â‰¡ğ•© ? 0 ; âŠ‘pairsâˆŠËœâ‹ˆâŸ¨ğ•¨,ğ•©âŸ© ? 1; âˆ}âŒœËœâ†•â‰ nodes
Distance â† âŒŠËâˆ˜+â‰1â€¿âˆ
dist â† DistanceâŸ(â‰ nodes)Ëœ { ğ•¨â‰¡ğ•© ? 0 ; âŠ‘pairsâˆŠËœâ‹ˆâŸ¨ğ•¨,ğ•©âŸ© ? 1; âˆ}âŒœËœâ†•â‰ nodes
# â€¢Show 2âŠdist # â†© dist DistanceâŸ(â‰ nodes) dist
To_visit â† (âŠ‘âˆ˜âŠ‘âˆ˜<)_to_heap
to_visit.Push<initial_state â† âŸ¨0, 0, 0, 0Ë™Â¨â†•â‰ nodesâŸ©
visited â† âŸ¨âŸ©
cand â† âŸ¨âŸ©
ExpandState â† { F âŸ¨time, flow, pos, statesâŸ©:
  # â€¢Show "time"â€¿time
  next_poses â† ((â†•â‰ )â‹ˆÂ¨âŠ¢) posâŠdist
  {F âŸ¨next_pos,costâŸ©:
    # â€¢Show "next_pos"â€¿next_pos
    # â€¢Show "state"â€¿states
    {next_posâŠ¸âŠ‘states ? @;
      new_states â† 1Ë™âŒ¾(next_posâŠ¸âŠ‘)states
      {âŠ‘(<states)âˆŠvisited ? @;
        # TODO: visited (statesâŠ¸âˆ¾)â†©
        # â€¢Show time+cost
        to_visit.Push<âŸ¨time+cost,flow+1âŠ‘next_posâŠ‘data,next_pos,new_statesâŸ©
      }
    }
  }Â¨ next_poses
  0
}
Traverse â† { F cands: 
  {to_visit.Empty @ ? cands;
    # â€¢Show to_visit.Dump @
    state â† to_visit.Pop @
    # â€¢Show "state"â€¿state
    # â€¢Show 26âŠ¸â‰¤âŠ‘state
    {26âŠ¸â‰¤âŠ‘state ? cand (1âŠ‘stateâŠ¸âˆ¾)â†© ;
      ExpandState state
    }
    Traverse cands
  }
}
â€¢Show âŠ‘âˆ¨Traverse âŸ¨âŸ©