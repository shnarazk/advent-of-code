#
# O(log(N)) heap constructed from order function: version 0.2.0
#

Parent â† {! 0<ğ•©â‹„  Â¯1+2Ã·Ëœ(1+ğ•©)-2|1+ğ•©}
Children â† {âŸ¨Â¯1+2Ã—Ëœ(1+ğ•©),2Ã—Ëœ(1+ğ•©)âŸ©}

_to_heap â‡ {ğ”½_ğ•£:
  l â† âŸ¨âŸ©
  Ord â† ğ”½
  Dump â‡ {ğ•¤ â‹„ l}
  Push â‡ {k â† â‰ l â‹„ l â†© lâˆ¾âŸ¨ğ•©âŸ© â‹„ ShiftUp k}
  ShiftUp â† {
    ğ•Š 0: @;
    ğ•Š n: {
      m â† Parent n
      âŸ¨p,câŸ© â† âŸ¨mâŠ‘l,nâŠ‘lâŸ©
      # â€¢Show "p"â€¿p 
      # â€¢Show "c"â€¿c 
      # â€¢Show c Ord p 
      {c Ord p ? l â†© pË™âŒ¾(nâŠ¸âŠ‘)cË™âŒ¾(mâŠ¸âŠ‘)l â‹„ ShiftUp m; @}
    }
  }
  Empty â‡ { ğ•¤
    0=â‰ l 
  }
  Pop â‡ { ğ•¤
    n â† Â¯1+â‰ l
    âŸ¨v,uâŸ© â† âŸ¨âŠ‘âŠ‘l,nâŠ‘lâŸ©
    l â†© uË™âŒ¾âŠ‘ l â‹„ Shiftdown 0 â‹„ l â†© nâ†‘l â‹„ v
  }
  ShiftDown â† { ğ•Š m:
    âŸ¨n1,n2âŸ© â† Children m
    {
      (â‰ l)â‰¤n1 ? @;
      (â‰ l)=1+n1 ? âŸ¨p,câŸ© â† âŸ¨mâŠ‘l,n1âŠ‘lâŸ© â‹„ l â†© pË™âŒ¾(n1âŠ¸âŠ‘)cË™âŒ¾(mâŠ¸âŠ‘)l;
        âŸ¨p,c1,c2âŸ© â† âŸ¨mâŠ‘l,n1âŠ‘l,n2âŠ‘lâŸ©
        # â€¢Show "c1"â€¿c1 
        # â€¢Show "c2"â€¿c2 
        # â€¢Show c1 (Ordâ—‹âŠ‘) c2 
        {c1 Ord c2 ? l â†© pË™âŒ¾(n1âŠ¸âŠ‘)c1Ë™âŒ¾(mâŠ¸âŠ‘)l â‹„ ShiftDown n1; l â†© pË™âŒ¾(n2âŠ¸âŠ‘)c2Ë™âŒ¾(mâŠ¸âŠ‘)l â‹„ ShiftDown n2}
    }
  }
}

# H â† â‰¤ _to_heap 
# h.Push<1
# h.Push<10
# h.Push<50
# h.Push<4
# h.Push<20
# h.Push<3
# h.Push<8
# h.Push<2
# h.Dump @
# â€¢Show h.Dump @
# ! 1 = h.Pop @
# ! 2 = h.Pop @
# ! 3 = h.Pop @
# ! 4 = h.Pop @
# ! 8 = h.Pop @
# ! 10 = h.Pop @
# ! 20 = h.Pop @
# ! 50 = h.Pop @
# â€¢Show h.Dump @
# G â† â‰¥ _to_heap 
# g.Push<1
# g.Push<10
# g.Push<50
# g.Push<4
# g.Push<20
# g.Push<3
# g.Push<8
# g.Push<2
# g.Dump @
# â€¢Show g.Dump @
# ! 50 = g.Pop @
# ! 20 = g.Pop @
# ! 10 = g.Pop @
# ! 8 = g.Pop @
# ! 4 = g.Pop @
# ! 3 = g.Pop @
# ! 2 = g.Pop @
# ! 1 = g.Pop @
# â€¢Show g.Dump @
