#
# O(log(N)) heap constructed from order function: version 0.2.0
#
# Note
# A heap is created from a comparing _dyadic_ function.
# So if, for example, you want to compare the first elements, use `Over` like:
#
#  H â† (â‰¤â—‹âŠ‘)_to_heap
#
* You can write as follow, but this is more expensive to compare all elements:
#
#  H â† (âŠ‘â‰¤)_to_heap
#
# And you will get a rank error by:
#
#  H â† (â‰¤âŠ‘)_to_heap
#

Parent â† {! 0<ğ•©â‹„  Â¯1+2Ã·Ëœ(1+ğ•©)-2|1+ğ•©}
Children â† {âŸ¨Â¯1+2Ã—Ëœ(1+ğ•©),2Ã—Ëœ(1+ğ•©)âŸ©}

_to_heap â‡ {ğ”½_ğ•£:
  l â† âŸ¨âŸ©
  Ord â† ğ”½
  Dump â‡ {ğ•¤ â‹„ l}
  Push â‡ {k â† â‰ l â‹„ l â†© lâˆ¾âŸ¨ğ•©âŸ© â‹„ ShiftUp k}
  ShiftUp â† {
    ğ•Š 0: @;
    ğ•Š n: {
      m â† Parent n
      âŸ¨p,câŸ© â† âŸ¨mâŠ‘l,nâŠ‘lâŸ©
      {c (Ordâ—‹âŠ‘) p ? l â†© pË™âŒ¾(nâŠ¸âŠ‘)cË™âŒ¾(mâŠ¸âŠ‘)l â‹„ ShiftUp m; @}
    }
  }
  Empty â‡ { ğ•¤
    0=â‰ l
  }
  Peek â‡ { ğ•¤ â‹„ âŠ‘âŠ‘l }
  Pop â‡ { ğ•¤
    n â† Â¯1+â‰ l
    âŸ¨v,uâŸ© â† âŸ¨âŠ‘âŠ‘l,nâŠ‘lâŸ©
    l â†© uË™âŒ¾âŠ‘ l â‹„ Shiftdown 0 â‹„ l â†© nâ†‘l â‹„ v
  }
  ShiftDown â† { ğ•Š m:
    âŸ¨n1,n2âŸ© â† Children m
    {
      (â‰ l)â‰¤n1 ? @;
      (â‰ l)=1+n1 ? âŸ¨p,câŸ© â† âŸ¨mâŠ‘l,n1âŠ‘lâŸ© â‹„ l â†© pË™âŒ¾(n1âŠ¸âŠ‘)cË™âŒ¾(mâŠ¸âŠ‘)l;
        âŸ¨p,c1,c2âŸ© â† âŸ¨mâŠ‘l,n1âŠ‘l,n2âŠ‘lâŸ©
        {c1 (Ordâ—‹âŠ‘) c2 ? l â†© pË™âŒ¾(n1âŠ¸âŠ‘)c1Ë™âŒ¾(mâŠ¸âŠ‘)l â‹„ ShiftDown n1; l â†© pË™âŒ¾(n2âŠ¸âŠ‘)c2Ë™âŒ¾(mâŠ¸âŠ‘)l â‹„ ShiftDown n2}
    }
  }
}

# H â† (âŠ‘â‰¤)_to_heap
# h.Push<âŸ¨1âŸ©
# h.Push<âŸ¨10âŸ©
# h.Push<âŸ¨50âŸ©
# h.Push<âŸ¨4âŸ©
# h.Push<âŸ¨20âŸ©
# h.Push<âŸ¨3âŸ©
# h.Push<âŸ¨8âŸ©
# h.Push<âŸ¨2âŸ©
# h.Dump @
# # â€¢Show h.Dump @
# # â€¢Show h.Peek @
# ! âŸ¨1âŸ© â‰¡ h.Pop @
# ! âŸ¨2âŸ© â‰¡ h.Pop @
# ! âŸ¨3âŸ© â‰¡ h.Pop @
# ! âŸ¨4âŸ© â‰¡ h.Pop @
# ! âŸ¨8âŸ© â‰¡ h.Pop @
# ! âŸ¨10âŸ© â‰¡ h.Pop @
# ! âŸ¨20âŸ© â‰¡ h.Pop @
# ! âŸ¨50âŸ© â‰¡ h.Pop @
# # â€¢Show h.Dump @

# G â† (âŠ‘â‰¥)_to_heap
# g.Push<âŸ¨1âŸ©
# g.Push<âŸ¨10âŸ©
# g.Push<âŸ¨50âŸ©
# g.Push<âŸ¨4âŸ©
# g.Push<âŸ¨20âŸ©
# g.Push<âŸ¨3âŸ©
# g.Push<âŸ¨8âŸ©
# g.Push<âŸ¨2âŸ©
# # â€¢Show g.Dump @
# ! âŸ¨50âŸ© â‰¡ g.Pop @
# ! âŸ¨20âŸ© â‰¡ g.Pop @
# ! âŸ¨10âŸ© â‰¡ g.Pop @
# ! âŸ¨8âŸ© â‰¡ g.Pop @
# ! âŸ¨4âŸ© â‰¡ g.Pop @
# ! âŸ¨3âŸ© â‰¡ g.Pop @
# ! âŸ¨2âŸ© â‰¡ g.Pop @
# ! âŸ¨1âŸ© â‰¡ g.Pop @
# # â€¢Show g.Dump @
